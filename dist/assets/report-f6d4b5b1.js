import{P as B,a3 as Dt,r as i,j as e,M as ae,aV as Ne,am as gt,G as q,p as S,T as j,L as Y,d as Q,aB as yt,B as jt,aO as Ae,aP as ft,D as Ee,aS as mt,a9 as Ue,I as We,Z as wt,x as ye,H as Pe}from"./index-0488e0de.js";import{C as Gt}from"./ComponentSkeleton-dcfb7096.js";import{L as Oe}from"./LoadingButton-8888a3e1.js";import{_ as de}from"./react-apexcharts.min-9843614b.js";import{u as St,S as Rt,f as Ie,b as Ct}from"./ScrollX-94ef5e02.js";import"./Filter-efb5d923.js";import{E as Pt,R as vt}from"./RowEditable-6d55d745.js";import"./LinearWithLabel-374ba1d5.js";import{T as Tt,a as bt,b as kt}from"./TableContainer-60d64b98.js";import{T as Lt}from"./TableHead-38172a4d.js";import{T as $e}from"./TableRow-da398186.js";import{T as Fe}from"./TableCell-faebffc1.js";import{S as At}from"./Slider-4031fe49.js";import{S as Et}from"./SendOutlined-d4b43d11.js";import"./Skeleton-51fcc206.js";import"./DownloadOutlined-6183d1da.js";import"./CaretUpOutlined-f8566736.js";import"./CaretDownOutlined-c84c279f.js";import"./Pagination-d6d43461.js";import"./index-9abf0ca1.js";import"./Checkbox-11dc58da.js";import"./MinusOutlined-646a018c.js";import"./visuallyHidden-14c3de6e.js";const Ke=({row:x,table:d})=>{var v;const p=(v=d==null?void 0:d.options)==null?void 0:v.meta,Z=V=>{p==null||p.setSelectedRow(O=>({...O,[x.id]:!O[x.id]})),p==null||p.revertData(x.index,(V==null?void 0:V.currentTarget.name)==="cancel")},k=()=>{p==null||p.saveData(x.index)};return e.jsxs(S,{direction:"row",spacing:1,alignItems:"center",children:[(p==null?void 0:p.selectedRow[x.id])&&e.jsx(Ue,{title:"Cancel",children:e.jsx(We,{color:"error",name:"cancel",onClick:Z,children:e.jsx(wt,{})})}),e.jsx(Ue,{title:p!=null&&p.selectedRow[x.id]?"Save":"Edit",children:e.jsx(We,{color:p!=null&&p.selectedRow[x.id]?"success":"primary",onClick:p!=null&&p.selectedRow[x.id]?k:Z,children:p!=null&&p.selectedRow[x.id]?e.jsx(Et,{}):e.jsx(Pt,{})})})]})};Ke.propTypes={row:B.object,table:B.object,options:B.array,id:B.number,index:B.number};B.node,B.number,B.number;const Me=Dt("input")({display:"none"});Me.displayName="Input";const je=x=>{let d=0,p=x.length-1;for(;d<x.length&&Number(x[d])===0;)d++;for(;p>=0&&Number(x[p])===0;)p--;return x.slice(d,p+1)},Ut=(x,d,p)=>x.map(k=>{const v=je(k.data);return{...k,data:v.slice(0,14)}}),ge=({getValue:x})=>{const d=x();return`${Number((d||0).toFixed(2)).toLocaleString()}`};function oe({columns:x,data:d,setData:p}){const[Z,k]=i.useState(()=>[...d]),[v,V]=i.useState({}),O=St({data:d,columns:x,defaultColumn:{cell:vt},getCoreRowModel:Ct(),meta:{selectedRow:v,setSelectedRow:V,revertData:(g,w)=>{w?p(X=>X.map((f,F)=>F===g?Z[g]:f)):k(X=>X.map((f,F)=>F===g?d[g]:f))},updateData:(g,w,X)=>{p(f=>f.map((F,u)=>u===g?{...f[g],[w]:X}:F))},saveData:async g=>{try{const w=d[g],X=await ye.put(`/api/launchGames/${w._id}`,w);Pe({open:!0,message:"Saved successfully!",variant:"alert",alert:{color:"success"}}),V(f=>({...f,[g]:!1}))}catch{Pe({open:!0,message:"Error!",variant:"alert",alert:{color:"error"}})}}},debugTable:!0});let H=[];return O.getAllColumns().map(g=>g.columnDef.accessorKey&&H.push({label:typeof g.columnDef.header=="string"?g.columnDef.header:"#",key:g.columnDef.accessorKey})),e.jsx(ae,{content:!1,children:e.jsx(Rt,{children:e.jsx(Tt,{children:e.jsxs(bt,{children:[e.jsx(Lt,{children:O.getHeaderGroups().map(g=>e.jsx($e,{children:g.headers.map(w=>e.jsx(Fe,{...w.column.columnDef.meta,children:w.isPlaceholder?null:Ie(w.column.columnDef.header,w.getContext())},w.id))},g.id))}),e.jsx(kt,{children:O.getRowModel().rows.map(g=>e.jsx($e,{children:g.getVisibleCells().map(w=>e.jsx(Fe,{...w.column.columnDef.meta,children:Ie(w.column.columnDef.cell,w.getContext())},w.id))},g.id))})]})})})})}oe.propTypes={columns:B.array,data:B.array,setData:B.func};function Wt({data:x,games:d}){const p=Ne(),[Z,k]=i.useState(p.pathname==="/admin/report"),[v,V]=i.useState([]),[O,H]=i.useState([]),[g,w]=i.useState([]);i.useEffect(()=>{const u=n=>{const r=n.getUTCMonth();return Math.floor(r/3)+1},h=n=>{const N=n.map(W=>new Date(W.summary)).sort((W,U)=>W-U),le=N[0],fe=N[N.length-1],z=le.getFullYear(),me=u(le),pe=fe.getFullYear(),we=u(fe),te=[];for(let W=z;W<=pe;W++)for(let U=1;U<=4;U++)if(!(W===z&&U<me)){if(W===pe&&U>we)break;te.push(`${W}-Q${U}`)}return te},I=[...new Set(x.map(n=>n.summary.split("-")[0]))];if(H(I),x&&x.length>0){const n=h(x);console.log("allQuarters",n),w(n)}const L=Object.values(x.reduce((n,{game:r,summary:N,betsEuro:le,winsEuro:fe,ggrEuro:z,avgBet:me,spins:pe,uniquePlayers:we})=>{n[r]||(n[r]={_id:"",name:r,maxDate:N,years:{},totalGGR:0,latestWeekStart:"",secLatestWeekStart:"",latestWeekGGR:[],secLatestWeekGGR:[],remainDays:0,weekAverage:0,weekChange:0,weekSum1:0,weekSum2:0,weekChangeColor:"",dailyTotalGGR:0,projectedTotalGGR:0});const te=d.find(W=>W.name===r);if(n[r].launchDate=te.launchDate,n[r]._id=te._id,new Date(te.launchDate)<=new Date(N)){const W=new Date(n[r].maxDate)<new Date(N);n[r].maxDate=W?N:n[r].maxDate,n[r].dailyTotalGGR=W?z:n[r].dailyTotalGGR,n[r].totalGGR+=z;const U=N.split("-")[0];n[r].years[U]||(n[r].years[U]=0),n[r].years[U]+=z,n[r][`totalGGR_${U}`]||(n[r][`totalGGR_${U}`]=0),n[r][`totalGGR_${U}`]+=z;const Ge=u(new Date(N)),he=`${U}-Q${Ge}`;n[r][`totalGGR_${he}`]||(n[r][`totalGGR_${he}`]=0),n[r][`totalGGR_${he}`]+=z;const Se=new Date(n[r].maxDate),ve=new Date(Se.getFullYear(),11,31);n[r].remainDays=Math.ceil((ve-Se)/(1e3*60*60*24));const Re=new Date(n[r].maxDate),se=new Date(Re);se.setDate(se.getDate()-6);const ie=new Date(se);ie.setDate(ie.getDate()-7);const xe=new Date(se);xe.setDate(xe.getDate()-1),n[r].latestWeekStart=se.toISOString().split("T")[0],n[r].secLatestWeekStart=ie.toISOString().split("T")[0],n[r].latestWeekGGR=x.filter(G=>G.game===r&&new Date(G.summary)>=se&&new Date(G.summary)<=Re).map(G=>G.ggrEuro),n[r].secLatestWeekGGR=x.filter(G=>G.game===r&&new Date(G.summary)>=ie&&new Date(G.summary)<=xe).map(G=>G.ggrEuro),n[r].weekSum1=n[r].latestWeekGGR.reduce((G,K)=>G+K,0),n[r].weekSum2=n[r].secLatestWeekGGR.reduce((G,K)=>G+K,0),n[r].weekAverage=n[r].latestWeekGGR.reduce((G,K)=>G+K,0)/n[r].latestWeekGGR.length,n[r].weekChange=(n[r].latestWeekGGR.reduce((G,K)=>G+K,0)-n[r].secLatestWeekGGR.reduce((G,K)=>G+K,0))/n[r].secLatestWeekGGR.reduce((G,K)=>G+K,0)*100,n[r].weekChangeColor=e.jsx("span",{style:{color:n[r].weekChange>0?"green":"red"},children:`${Number(n[r].weekChange.toFixed(2)).toLocaleString()} %`}),n[r].projectedTotalGGR=n[r].totalGGR+n[r].weekAverage*n[r].remainDays}return n},{}));console.log("gameDatagameDatagameData",L),V(L)},[x,d]);const X=i.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text",cell:({getValue:u,row:h})=>{const I=u();return e.jsx(Y,{style:{textDecoration:"none"},to:Z?`/admin/report-one/${h.original._id}`:`/report-one/${h.original._id}`,children:I})}},{header:"Launch Date",accessorKey:"launchDate",dataType:"text",cell:({getValue:u,row:h,table:I})=>{var n;const L=u();return`${(n=L==null?void 0:L.split("T"))==null?void 0:n[0]}`}},{header:"Daily Total GGR",accessorKey:"dailyTotalGGR",dataType:"text",cell:ge},{header:"Projected Total GGR",accessorKey:"projectedTotalGGR",dataType:"text",cell:ge},...(O==null?void 0:O.map(u=>({header:`Total GGR ${u}`,accessorKey:`totalGGR_${u}`,dataType:"text",cell:ge})))||[],{header:"Lifetime GGR",accessorKey:"totalGGR",dataType:"text",cell:ge},{header:"7 Day Average",accessorKey:"weekAverage",dataType:"text",cell:ge},{header:"7 Day Change",accessorKey:"weekChangeColor",dataType:"text"},{header:"Latest Report Date",accessorKey:"maxDate",dataType:"text",cell:({getValue:u,row:h,table:I})=>{var n;const L=u();return`${(n=L==null?void 0:L.split("T"))==null?void 0:n[0]}`}}],[O]),f=i.useMemo(()=>{const u=[];return g.forEach(h=>{const I={quarter:h};v.forEach(L=>{const n=L[`totalGGR_${h}`]!==void 0?Number(L[`totalGGR_${h}`].toFixed(2)).toLocaleString():0;console.log("gameTotalGGR",n),I[L.name]=n}),u.push(I)}),u},[g,v]),F=i.useMemo(()=>{const u=d.map(h=>h.name);return[{header:"Quarter",accessorKey:"quarter",dataType:"text"},...u.map(h=>({header:h,accessorKey:h,dataType:"number",cell:I=>I.getValue()??0}))]},[d]);return e.jsxs(q,{item:!0,xs:12,lg:12,children:[e.jsxs(q,{container:!0,spacing:2,mb:5,children:[e.jsx(q,{item:!0,xs:6,lg:3,children:e.jsx(ae,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(S,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(j,{variant:"h5",textAlign:"center",children:"Lifetime GGR - "}),e.jsx(j,{variant:"h6",textAlign:"center",children:Number(v.reduce((u,h)=>u+h.totalGGR,0)).toLocaleString()})]})})}),e.jsx(q,{item:!0,xs:6,lg:3,children:e.jsx(ae,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(S,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(j,{variant:"h5",textAlign:"center",children:"Daily Total GGR -"}),e.jsx(j,{variant:"h6",textAlign:"center",children:Number(v.reduce((u,h)=>u+h.dailyTotalGGR,0)).toLocaleString()})]})})}),e.jsx(q,{item:!0,xs:6,lg:3,children:e.jsx(ae,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(S,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(j,{variant:"h5",textAlign:"center",children:"7 Day Average GGR -"}),e.jsx(j,{variant:"h6",textAlign:"center",children:Number(v.reduce((u,h)=>u+h.weekAverage,0)).toLocaleString()})]})})}),e.jsx(q,{item:!0,xs:6,lg:3,children:e.jsx(ae,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(S,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(j,{variant:"h5",textAlign:"center",children:"7 Day Change -"}),e.jsx(j,{variant:"h6",textAlign:"center",children:(v.reduce((u,h)=>u+h.weekChange,0)/v.length).toFixed(2)+"%"})]})})}),e.jsx(q,{item:!0,xs:6,lg:3,children:e.jsx(ae,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(S,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(j,{variant:"h5",textAlign:"center",children:`Projected GGR ${O.reduce((u,h)=>Math.max(u,h),-1/0)} -`}),e.jsx(j,{variant:"h6",textAlign:"center",children:Number(v.reduce((u,h)=>u+h.projectedTotalGGR,0)).toLocaleString()})]})})}),e.jsx(q,{item:!0,xs:6,lg:3,children:e.jsx(ae,{sx:{height:"100%",display:"flex",alignItems:"center"},children:g==null?void 0:g.map((u,h)=>e.jsxs(S,{direction:"row",spacing:1,alignItems:"end",justifyContent:"start",children:[e.jsx(j,{variant:"h5",textAlign:"center",children:`Total GGR ${u} - `}),e.jsx(j,{variant:"h6",textAlign:"center",children:Number(v.reduce((I,L)=>I+(L[`totalGGR_${u}`]||0),0)).toLocaleString()})]},h))})})]}),e.jsxs(S,{mb:5,spacing:3,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"Games Data"}),e.jsx(oe,{data:v,columns:X})]}),e.jsxs(S,{mb:5,spacing:3,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"TOTAL GGR - QUARTER"}),e.jsx(oe,{data:f,columns:F,setData:()=>{}})]})]})}const ue={chart:{height:100,type:"line",zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"straight",width:3},xaxis:{categories:[]}},is=()=>{const x=Ne(),[d,p]=i.useState(x.pathname==="/admin/report"),{user:Z}=gt();i.useState(0);const[k,v]=i.useState(!1),[V,O]=i.useState(!1),[H,g]=i.useState([]),[w,X]=i.useState([]),[f,F]=i.useState([]),[u,h]=i.useState(!0),[I,L]=i.useState(""),[n,r]=i.useState(""),[N,le]=i.useState(!1),[fe,z]=i.useState([]),[me,pe]=i.useState([]),[we,te]=i.useState([]),[W,U]=i.useState([]),[Ge,he]=i.useState([]),[Se,ve]=i.useState(ue),[Re,se]=i.useState(ue),[ie,xe]=i.useState(ue),[G,K]=i.useState(ue),[_e,qe]=i.useState(ue),[Qe,Ot]=i.useState(new Date().toISOString().split("T")[0]),[Ye,Be]=i.useState([]),[Ve,He]=i.useState(ue),[Xe,ze]=i.useState([]),[Ze,Je]=i.useState([]),[et,tt]=i.useState([]),[st,nt]=i.useState([]),[$,be]=i.useState([1,37]),[at,rt]=i.useState(0),ot=(D,A)=>{console.log("newRange",A),be(A)},lt=i.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"Launch Date",accessorKey:"launchDate",dataType:"date",cell:({getValue:D,row:A,table:c})=>{var s,a;const E=(s=c==null?void 0:c.options)==null?void 0:s.meta,J=(a=E==null?void 0:E.selectedRow)==null?void 0:a[A.id],ne=D(),re=ne?new Date(ne).toISOString().split("T")[0]:"";return J?e.jsx("input",{type:"date",value:re,onChange:o=>E==null?void 0:E.updateData(A.index,"launchDate",o.target.value)}):re}},{header:"Actions",id:"edit",cell:Ke,meta:{className:"cell-center"}}],[]),it=i.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"TOTAL GGR",accessorKey:"data",dataType:"text",cell:({getValue:D,row:A,table:c})=>{const E=D();return`${(Number(E[E.length-1])||0).toLocaleString()}`}}],[]),ke=i.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"GGR",accessorKey:"ggrEuro",dataType:"text"},{header:"SPINS",accessorKey:"spins",dataType:"text"},{header:"USERS",accessorKey:"uniquePlayers",dataType:"text"},{header:"SPU",accessorKey:"SPU",dataType:"text"},{header:"CWPP",accessorKey:"CWPP",dataType:"text"}],[]);i.useEffect(()=>{const D=[];for(let s=0;s<7;s++){const a=new Date;a.setDate(a.getDate()-s),D.push(a.toISOString().split("T")[0])}const A=w.reduce((s,{game:a,summary:o})=>{if(!s[a]){const R=f.find(C=>C.name===a);s[a]={...R,maxDate:o}}const y=new Date(s[a].maxDate)<new Date(o);return s[a].maxDate=y?o:s[a].maxDate,s},{}),c={},J=Object.values(w.reduce((s,{game:a,summary:o,ggrEuro:y,spins:R,uniquePlayers:C,betsEuro:T})=>{s[a]||(s[a]={name:a,ggrEuro:[],spins:[],uniquePlayers:[],SPU:[],CWPP:[]});const P=f.find(Ce=>Ce.name===a);new Date(P==null?void 0:P.launchDate)<new Date(o),c[a]&&new Date(c[a])<new Date(o.split("T")[0])?c[a]=o.split("T")[0]:c[a]||(c[a]=o.split("T")[0]);const ee=new Date(A[a].maxDate)||new Date,ce=new Date(ee);return ce.setDate(ce.getDate()-6),new Date(o)>=ce&&new Date(o)<=ee&&(s[a].ggrEuro.push(y),s[a].spins.push(R),s[a].uniquePlayers.push(C),s[a].SPU.push(R/C),s[a].CWPP.push(T/C)),s},{})).map(s=>{const a=s.ggrEuro,o=s.spins,y=s.uniquePlayers,R=s.SPU,C=s.CWPP;return{name:s.name,ggrEuro:Number((a.length>0?a.reduce((T,P)=>T+P,0)/a.length:0).toFixed(2)).toLocaleString(),spins:Number((o.length>0?o.reduce((T,P)=>T+P,0)/o.length:0).toFixed(2)).toLocaleString(),uniquePlayers:Number((y.length>0?y.reduce((T,P)=>T+P,0)/y.length:0).toFixed(2)).toLocaleString(),SPU:Number((R.length>0?R.reduce((T,P)=>T+P,0)/R.length:0).toFixed(2)).toLocaleString(),CWPP:Number((C.length>0?C.reduce((T,P)=>T+P,0)/C.length:0).toFixed(2)).toLocaleString()}});te(J);const re=Object.values(w.reduce((s,{game:a,summary:o,ggrEuro:y,spins:R,uniquePlayers:C,betsEuro:T})=>{s[a]||(s[a]={name:a,ggrEuros:[],ggrEuro:0,ggrEuro2:0,spins:0,spins2:0,uniquePlayers:0,uniquePlayers2:0,SPU:0,SPU2:0,CWPP:0,CWPP2:0,arrSpins:[],arrSpins2:[]});const P=new Date(c[a]);P.setDate(P.getDate()-7);const ee=new Date(c[a]);return ee.setDate(ee.getDate()-14),P<new Date(o)?(s[a].ggrEuros.push(y),s[a].arrSpins.push(R),s[a].ggrEuro+=y,s[a].spins+=R,s[a].uniquePlayers+=C,s[a].SPU+=R/C,s[a].CWPP+=T/C):ee<new Date(o)&&new Date(o)<=P&&(s[a].arrSpins2.push(R),s[a].ggrEuro2+=y,s[a].spins2+=R,s[a].uniquePlayers2+=C,s[a].SPU2+=R/C,s[a].CWPP2+=T/C),s},{})).map(s=>{const a=(s.ggrEuro-s.ggrEuro2)/(s.ggrEuro2||1),o=(s.spins-s.spins2)/(s.spins2||1),y=(s.uniquePlayers-s.uniquePlayers2)/(s.uniquePlayers2||1),R=(s.SPU-s.SPU2)/(s.SPU2||1),C=(s.CWPP-s.CWPP2)/(s.CWPP2||1);return{name:s.name,ggrEuro:e.jsx("span",{style:{color:a>=0?"green":"red"},children:`${(a*100).toFixed(2)} %`}),spins:e.jsx("span",{style:{color:o>=0?"green":"red"},children:`${(o*100).toFixed(2)} %`}),uniquePlayers:e.jsx("span",{style:{color:y>=0?"green":"red"},children:`${(y*100).toFixed(2)} %`}),SPU:e.jsx("span",{style:{color:R>=0?"green":"red"},children:`${(R*100).toFixed(2)} %`}),CWPP:e.jsx("span",{style:{color:C>=0?"green":"red"},children:`${(C*100).toFixed(2)} %`})}});U(re)},[me,w,f]);const Le=async()=>{var D,A;try{const c=await ye.get("api/reports");if(console.log("response.data.data",c.data.data),console.log("response.data.setGames",c.data.games),g(c.data.data),F(c.data.games),c.data.games.length>0){const E=c.data.games.length>0?(A=(D=c.data.games)==null?void 0:D.reduce((o,y)=>new Date(y.launchDate)<new Date(o.launchDate)?y:o).launchDate)==null?void 0:A.split("T")[0]:new Date().toISOString().split("T")[0],J=[...c.data.data].filter(o=>new Date(o.summary)>=new Date(E));J.sort((o,y)=>new Date(o.summary)-new Date(y.summary));const ne=[],re=Object.values(J.reduce((o,{game:y,ggrEuro:R,summary:C})=>{o[y]||(o[y]={name:y,data:[],totalGGR:0});const T=c.data.games.find(P=>P.name===y);return o[y].totalGGR+=new Date(T==null?void 0:T.launchDate)>new Date(C)?0:R,o[y].data.push(o[y].totalGGR.toFixed(2)),ne.push(C.slice(0,10)),o},{}));let s=0;const a=re.map(o=>(s=Math.max(s,o.data.length),{...o,data:je(o.data)}));console.log("min, max",s),rt(s),be([1,s])}}catch{}},ct=async()=>{const D=localStorage.getItem("reportToken");h(D!=="true"),Le()};i.useEffect(()=>{ct()},[]);const dt=async D=>{if(D.target.files.length>0){const A=D.target.files[0];if(!A){alert("Please select a file first.");return}v(!0);const c=new FormData;c.append("file",A);try{const E=await ye.post("api/reports/upload",c,{headers:{"Content-Type":"multipart/form-data"}});Pe({open:!0,message:"Excel uploaded successfully!",variant:"alert",alert:{color:"success"}}),Le(),v(!0)}catch(E){console.error("Upload Error:",E),alert("Error uploading file.")}finally{v(!1),D.target.value=""}}},ut=async()=>{O(!0);try{const D=await ye.get("api/reports/download",{responseType:"blob"}),A=window.URL.createObjectURL(new Blob([D.data])),c=document.createElement("a");c.href=A,c.setAttribute("download","report.xlsx"),document.body.appendChild(c),c.click(),document.body.removeChild(c)}catch(D){console.error("Download Error:",D),Pe({open:!0,message:"Excel not exists!",variant:"alert",alert:{color:"error"}})}finally{O(!1)}};i.useEffect(()=>{var D;if(f.length>0){const A=f.length>0?(D=f==null?void 0:f.reduce((t,l)=>new Date(l.launchDate)<new Date(t.launchDate)?l:t).launchDate)==null?void 0:D.split("T")[0]:new Date().toISOString().split("T")[0],c=[...H].filter(t=>new Date(t.summary)>=new Date(A));c.sort((t,l)=>new Date(t.summary)-new Date(l.summary));const E=[],J=Object.values(c.reduce((t,{game:l,ggrEuro:m,summary:_})=>{t[l]||(t[l]={name:l,data:[],totalGGR:0});const b=f.find(M=>M.name===l);return t[l].totalGGR+=new Date(b==null?void 0:b.launchDate)>new Date(_)?0:m,t[l].data.push(t[l].totalGGR.toFixed(2)),E.push(_.slice(0,10)),t},{}));let ne=0;const s=J.map(t=>(ne=Math.max(ne,t.data.length),{...t,data:je(t.data)})).map(t=>{const l=$[0]-1,m=$[1]-1;return t.data=t.data.slice(l,m+1),t});he(s);const a=[...new Set(E)];pe(a);const o=[];for(let t=$[0];t<=$[1];t++)o.push(`Day ${t}`);const y=H==null?void 0:H.map(t=>({...t,SPU:t.spins/t.uniquePlayers,CWPP:t.betsEuro/t.uniquePlayers}));X(y);const R=[];for(let t=0;t<14;t++)R.push(`Day ${t+1}`);He(t=>({...t,xaxis:{categories:R,labels:{show:!1}}})),Be(Ut(J));const T=Object.values(c.reduce((t,{game:l,summary:m,uniquePlayers:_})=>{t[l]||(t[l]={name:l,data:[]});const b=f.find(M=>M.name===l);return new Date(b==null?void 0:b.launchDate)<=new Date(m)&&t[l].data.push(_),t},{})).map(t=>{const l=$[0]-1,m=$[1]-1;return t.data=t.data.slice(l,m+1),t});console.log("filterUsersData1",T),ze(T);const P=t=>{if(t.length<6)return[];let l=new Array(5).fill(0);for(let m=5;m<t.length;m++){let _=t.slice(m-4,m+1).reduce((De,Te)=>De+Te,0),b=t.slice(m-5,m).reduce((De,Te)=>De+Te,0),M=((_-b)/(b||1)*100).toFixed(2);l.push(M)}return l},ee=Object.values(c.reduce((t,{game:l,summary:m,uniquePlayers:_})=>{t[l]||(t[l]={name:l,data:[]});const b=f.find(M=>M.name===l);return new Date(b==null?void 0:b.launchDate)<=new Date(m)&&t[l].data.push(_),t},{})),ce=ee.map(t=>({...t,data:P(t.data)}));console.log("usersData2",ce);const Ce=ce.map(t=>{const l=$[0]-1,m=$[1]-1;return t.data=t.data.slice(l,m+1),{...t,data:t.data}});console.log("filterUserChangesData",Ce),Je(Ce),console.log("usersData",ee);const ht=Object.values(c.reduce((t,{game:l,spins:m,summary:_})=>{t[l]||(t[l]={name:l,data:[]});const b=f.find(M=>M.name===l);return t[l].data.push(new Date(b==null?void 0:b.launchDate)>new Date(_)?0:m),t},{})).map(t=>{const l=$[0]-1,m=$[1]-1;return t.data=t.data.slice(l,m+1),{...t,data:je(t.data)}});tt(ht);const xt=Object.values(c.reduce((t,{game:l,spins:m,uniquePlayers:_,summary:b})=>{t[l]||(t[l]={name:l,data:[]});const M=f.find(De=>De.name===l);return t[l].data.push(new Date(M==null?void 0:M.launchDate)>new Date(b)?0:(m/_).toFixed(2)),t},{})).map(t=>{const l=$[0]-1,m=$[1]-1;return t.data=t.data.slice(l,m+1),{...t,data:je(t.data)}});z(o),console.log("days",o),ve(t=>({...t,xaxis:{categories:o,labels:{show:!1}}})),se(t=>({...t,xaxis:{categories:o,labels:{show:!1}}})),xe(t=>({...t,xaxis:{categories:o,labels:{show:!1}}})),K(t=>({...t,xaxis:{categories:o,labels:{show:!1}}})),qe(t=>({...t,xaxis:{categories:o,labels:{show:!1}}})),nt(xt)}},[H,Qe,f,$]);const pt=async()=>{try{const D=await ye.post("api/account/check",{email:d?Z.email:n,password:I});localStorage.setItem("reportToken","true"),le(!1),h(!1)}catch{le(!0)}};return e.jsxs(Gt,{children:[e.jsx(ae,{children:!u&&e.jsxs(q,{item:!0,xs:12,lg:12,children:[e.jsxs(S,{mb:3,spacing:1,display:"flex",flexDirection:"row",alignItems:"center",gap:2,justifyContent:"space-between",children:[e.jsxs(q,{item:!0,children:[e.jsxs("label",{htmlFor:"contained-button-file",children:[e.jsx(Me,{accept:".xls,.xlsx",id:"contained-button-file",type:"file",onChange:dt}),e.jsx(Oe,{loading:k,variant:"contained",component:"span",children:"Upload Excel"})]}),e.jsx(Oe,{sx:{marginLeft:"10px"},loading:V,variant:"contained",component:"span",onClick:ut,children:"Download Excel"})]}),e.jsxs(q,{sx:{marginTop:"0px !important"},gap:2,display:"flex",flexDirection:"row",alignItems:"center",children:[e.jsx(j,{variant:"h5",textAlign:"right",children:"LAUNCH"}),e.jsx(Y,{Link:!0,to:d?"/admin/report-type/users/launch":"/report-type/users/launch",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"Users"})}),e.jsx(Y,{to:d?"/admin/report-type/totalGGR/launch":"/report-type/totalGGR/launch",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"Total GGR"})}),e.jsx(Y,{to:d?"/admin/report-type/spinsPerUser/launch":"/report-type/spinsPerUser/launch",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"Spins Per User"})}),e.jsx(Y,{to:d?"/admin/report-type/totalCoins/launch":"/report-type/totalCoins/launch",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"Total Coins"})}),e.jsx(Y,{to:d?"/admin/report-type/cwpp/launch":"/report-type/cwpp/launch",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"CWPP"})})]})]}),e.jsx(S,{mb:3,spacing:1,display:"flex",flexDirection:"row",alignItems:"center",gap:2,justifyContent:"end",children:e.jsxs(q,{sx:{marginTop:"0px !important"},gap:2,display:"flex",flexDirection:"row",alignItems:"center",children:[e.jsx(j,{variant:"h5",textAlign:"right",children:"EXCLUSIVE"}),e.jsx(Y,{to:d?"/admin/report-type/users/exclusive":"/report-type/users/exclusive",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"Users"})}),e.jsx(Y,{to:d?"/admin/report-type/totalGGR/exclusive":"/report-type/totalGGR/exclusive",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"Total GGR"})}),e.jsx(Y,{to:d?"/admin/report-type/spinsPerUser/exclusive":"/report-type/spinsPerUser/exclusive",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"Spins Per User"})}),e.jsx(Y,{to:d?"/admin/report-type/totalCoins/exclusive":"/report-type/totalCoins/exclusive",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"Total Coins"})}),e.jsx(Y,{to:d?"/admin/report-type/cwpp/exclusive":"/report-type/cwpp/exclusive",children:e.jsx(Q,{loading:k,variant:"contained",component:"span",children:"CWPP"})})]})}),e.jsx(S,{mb:5,spacing:3,children:e.jsx(Wt,{data:H,games:f})}),e.jsxs(S,{mb:5,spacing:3,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"Launch Information"}),e.jsx(oe,{data:f,columns:lt,setData:F})]}),e.jsxs(S,{mb:5,spacing:3,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"TOTAL REVENUE"}),e.jsx(oe,{data:Ge,columns:it,setData:F})]}),e.jsxs(S,{mb:5,spacing:3,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"7 Day Averages"}),e.jsx(oe,{data:we,columns:ke,setData:F})]}),e.jsxs(S,{mb:5,spacing:3,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"7 Day Change (%) "}),e.jsx(oe,{data:W,columns:ke,setData:F})]}),e.jsxs(S,{mb:5,direction:"row",spacing:3,alignItems:"center",justifyContent:"center",children:[e.jsx(j,{variant:"h2",children:"Time Period"}),e.jsx(At,{getAriaLabel:()=>"Temperature range",value:$,max:at,min:1,onChange:ot,valueLabelDisplay:"auto",valueLabelFormat:D=>`Day ${D}`,sx:{width:"40%"}})]}),e.jsxs(S,{mb:5,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"Total GGR"}),e.jsx(de,{options:Se,series:Ge,type:"line",height:500})]}),e.jsxs(S,{mb:5,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"USERS"}),e.jsx(de,{options:Re,series:Xe,type:"line",height:500})]}),e.jsxs(S,{mb:5,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"USER 5 Day Change (%)"}),e.jsx(de,{options:ie,series:Ze,type:"line",height:500})]}),e.jsxs(S,{mb:5,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"SPINS PER DAY"}),e.jsx(de,{options:G,series:et,type:"line",height:500})]}),e.jsxs(S,{mb:5,children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"SPINS PER PLAYER"}),e.jsx(de,{options:_e,series:st,type:"line",height:500})]}),e.jsxs(S,{children:[e.jsx(j,{variant:"h2",textAlign:"center",children:"14 DAY LAUNCH"}),e.jsx(de,{options:Ve,series:Ye,type:"line",height:500})]})]})}),e.jsx(yt,{open:u,maxWidth:"xs",children:e.jsxs(jt,{sx:{p:1,py:1.5},children:[d?e.jsx(Ae,{children:"Confirm Password"}):e.jsx(Ae,{children:"Login"}),e.jsxs(ft,{children:[e.jsxs(S,{spacing:1,mb:2,children:[!d&&e.jsx(Ee,{name:"email",placeholder:"Email",type:"email",fullWidth:!0,variant:"outlined",value:n,onChange:D=>r(D.target.value)}),e.jsx(Ee,{name:"password",placeholder:"Password",type:"password",fullWidth:!0,variant:"outlined",value:I,onChange:D=>L(D.target.value)})]}),N&&d&&e.jsx(j,{variant:"h6",color:"red",children:"Password is wrong."}),N&&!d&&e.jsx(j,{variant:"h6",color:"red",children:"Credentials is wrong."}),"          "]}),e.jsx(mt,{children:e.jsx(Q,{variant:"contained",onClick:pt,children:"Confirm"})})]})})]})};export{oe as ReactTable,is as default,ge as separateByComma};
