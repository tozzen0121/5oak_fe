import{r as o,P as oe,a3 as Kt,j as t,M as ge,aV as ut,am as Nt,G as ne,p as b,T as G,L as re,d as ae,aB as Mt,B as qt,aO as nt,aP as _t,D as st,aS as Qt,a9 as at,I as rt,Z as Yt,x as Re,H as ke}from"./index-b5c3012f.js";import{C as Bt}from"./ComponentSkeleton-0ecce135.js";import{L as ot}from"./LoadingButton-61afe1da.js";import{_ as fe}from"./react-apexcharts.min-24810b13.js";import{u as Vt,S as Ht,f as it,b as Xt}from"./ScrollX-d6386fe3.js";import"./Filter-a54b724f.js";import{E as zt,R as Zt}from"./RowEditable-0e641f52.js";import"./LinearWithLabel-2d381b46.js";import{T as Jt,a as en,b as tn}from"./TableContainer-ee7c7431.js";import{T as nn}from"./TableHead-229ba6d1.js";import{T as lt}from"./TableRow-95fefb3b.js";import{T as ct}from"./TableCell-0c2ea5ca.js";import{S as sn}from"./Slider-7979f4f5.js";import{S as an}from"./SendOutlined-1e5c1e92.js";import"./Skeleton-d9a17e6d.js";import"./DownloadOutlined-599e8a38.js";import"./CaretUpOutlined-97a7b630.js";import"./CaretDownOutlined-de506154.js";import"./Pagination-51db5a39.js";import"./index-4e42511c.js";import"./Checkbox-b1206aed.js";import"./MinusOutlined-02c1a42c.js";import"./visuallyHidden-14c3de6e.js";function rn(f,c,u,ee){var U=this,v=o.useRef(null),Y=o.useRef(0),$=o.useRef(0),A=o.useRef(null),y=o.useRef([]),C=o.useRef(),B=o.useRef(),S=o.useRef(f),K=o.useRef(!0);S.current=f;var h=typeof window<"u",D=!c&&c!==0&&h;if(typeof f!="function")throw new TypeError("Expected a function");c=+c||0;var q=!!(u=u||{}).leading,H=!("trailing"in u)||!!u.trailing,r="maxWait"in u,l="debounceOnServer"in u&&!!u.debounceOnServer,V=r?Math.max(+u.maxWait||0,c):null;o.useEffect(function(){return K.current=!0,function(){K.current=!1}},[]);var ce=o.useMemo(function(){var de=function(w){var _=y.current,se=C.current;return y.current=C.current=null,Y.current=w,$.current=$.current||w,B.current=S.current.apply(se,_)},X=function(w,_){D&&cancelAnimationFrame(A.current),A.current=D?requestAnimationFrame(w):setTimeout(w,_)},we=function(w){if(!K.current)return!1;var _=w-v.current;return!v.current||_>=c||_<0||r&&w-Y.current>=V},ue=function(w){return A.current=null,H&&y.current?de(w):(y.current=C.current=null,B.current)},xe=function w(){var _=Date.now();if(q&&$.current===Y.current&&ie(),we(_))return ue(_);if(K.current){var se=c-(_-v.current),Se=r?Math.min(se,V-(_-Y.current)):se;X(w,Se)}},ie=function(){ee&&ee({})},E=function(){if(h||l){var w=Date.now(),_=we(w);if(y.current=[].slice.call(arguments),C.current=U,v.current=w,_){if(!A.current&&K.current)return Y.current=v.current,X(xe,c),q?de(v.current):B.current;if(r)return X(xe,c),de(v.current)}return A.current||X(xe,c),B.current}};return E.cancel=function(){A.current&&(D?cancelAnimationFrame(A.current):clearTimeout(A.current)),Y.current=0,y.current=v.current=C.current=A.current=null},E.isPending=function(){return!!A.current},E.flush=function(){return A.current?ue(Date.now()):B.current},E},[q,r,c,V,H,D,h,l,ee]);return ce}const pt=({row:f,table:c})=>{var v;const u=(v=c==null?void 0:c.options)==null?void 0:v.meta,ee=Y=>{u==null||u.setSelectedRow($=>({...$,[f.id]:!$[f.id]})),u==null||u.revertData(f.index,(Y==null?void 0:Y.currentTarget.name)==="cancel")},U=()=>{u==null||u.saveData(f.index)};return t.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[(u==null?void 0:u.selectedRow[f.id])&&t.jsx(at,{title:"Cancel",children:t.jsx(rt,{color:"error",name:"cancel",onClick:ee,children:t.jsx(Yt,{})})}),t.jsx(at,{title:u!=null&&u.selectedRow[f.id]?"Save":"Edit",children:t.jsx(rt,{color:u!=null&&u.selectedRow[f.id]?"success":"primary",onClick:u!=null&&u.selectedRow[f.id]?U:ee,children:u!=null&&u.selectedRow[f.id]?t.jsx(an,{}):t.jsx(zt,{})})})]})};pt.propTypes={row:oe.object,table:oe.object,options:oe.array,id:oe.number,index:oe.number};oe.node,oe.number,oe.number;const ht=Kt("input")({display:"none"});ht.displayName="Input";const he=f=>{let c=0,u=f.length-1;for(;c<f.length&&Number(f[c])===0;)c++;for(;u>=0&&Number(f[u])===0;)u--;return f.slice(c,u+1)},dt=(f,c,u)=>f.map(U=>{const v=he(U.data);return{...U,data:v.slice(0,14)}}),Pe=({getValue:f})=>{const c=f();return`${Number((c||0).toFixed(2)).toLocaleString()}`};function Ge({columns:f,data:c,setData:u}){const[ee,U]=o.useState(()=>[...c]),[v,Y]=o.useState({}),$=Vt({data:c,columns:f,defaultColumn:{cell:Zt},getCoreRowModel:Xt(),meta:{selectedRow:v,setSelectedRow:Y,revertData:(y,C)=>{C?u(B=>B.map((S,K)=>K===y?ee[y]:S)):U(B=>B.map((S,K)=>K===y?c[y]:S))},updateData:(y,C,B)=>{u(S=>S.map((K,h)=>h===y?{...S[y],[C]:B}:K))},saveData:async y=>{try{const C=c[y],B=await Re.put(`/api/launchGames/${C._id}`,C);ke({open:!0,message:"Saved successfully!",variant:"alert",alert:{color:"success"}}),Y(S=>({...S,[y]:!1}))}catch{ke({open:!0,message:"Error!",variant:"alert",alert:{color:"error"}})}}},debugTable:!0});let A=[];return $.getAllColumns().map(y=>y.columnDef.accessorKey&&A.push({label:typeof y.columnDef.header=="string"?y.columnDef.header:"#",key:y.columnDef.accessorKey})),t.jsx(ge,{content:!1,children:t.jsx(Ht,{children:t.jsx(Jt,{children:t.jsxs(en,{children:[t.jsx(nn,{children:$.getHeaderGroups().map(y=>t.jsx(lt,{children:y.headers.map(C=>t.jsx(ct,{...C.column.columnDef.meta,children:C.isPlaceholder?null:it(C.column.columnDef.header,C.getContext())},C.id))},y.id))}),t.jsx(tn,{children:$.getRowModel().rows.map(y=>t.jsx(lt,{children:y.getVisibleCells().map(C=>t.jsx(ct,{...C.column.columnDef.meta,children:it(C.column.columnDef.cell,C.getContext())},C.id))},y.id))})]})})})})}Ge.propTypes={columns:oe.array,data:oe.array,setData:oe.func};function on({data:f,games:c}){const u=ut(),[ee,U]=o.useState(u.pathname==="/admin/report"),[v,Y]=o.useState([]),[$,A]=o.useState([]),[y,C]=o.useState([]);o.useEffect(()=>{const h=r=>{const l=r.getUTCMonth();return Math.floor(l/3)+1},D=r=>{const V=r.map(E=>new Date(E.summary)).sort((E,w)=>E-w),ce=V[0],de=V[V.length-1],X=ce.getFullYear(),we=h(ce),ue=de.getFullYear(),xe=h(de),ie=[];for(let E=X;E<=ue;E++)for(let w=1;w<=4;w++)if(!(E===X&&w<we)){if(E===ue&&w>xe)break;ie.push(`${E}-Q${w}`)}return ie},q=[...new Set(f.map(r=>r.summary.split("-")[0]))];if(A(q),f&&f.length>0){const r=D(f);C(r)}const H=Object.values(f.reduce((r,{game:l,summary:V,betsEuro:ce,winsEuro:de,ggrEuro:X,avgBet:we,spins:ue,uniquePlayers:xe})=>{r[l]||(r[l]={_id:"",name:l,maxDate:V,years:{},totalGGR:0,latestWeekStart:"",secLatestWeekStart:"",latestWeekGGR:[],secLatestWeekGGR:[],remainDays:0,weekAverage:0,weekChange:0,weekSum1:0,weekSum2:0,weekChangeColor:"",dailyTotalGGR:0,projectedTotalGGR:0,LifeTimePayout:0,betsEuro:ce,winsEuro:de});const ie=c.find(E=>E.name===l);if(r[l].launchDate=ie.launchDate,r[l]._id=ie._id,new Date(ie.launchDate)<=new Date(V)){const E=new Date(r[l].maxDate)<new Date(V);r[l].maxDate=E?V:r[l].maxDate,r[l].dailyTotalGGR=E?X:r[l].dailyTotalGGR,r[l].totalGGR+=X;const w=V.split("-")[0];r[l].years[w]||(r[l].years[w]=0),r[l].years[w]+=X,r[l][`totalGGR_${w}`]||(r[l][`totalGGR_${w}`]=0),r[l][`totalGGR_${w}`]+=X;const _=h(new Date(V)),se=`${w}-Q${_}`;r[l][`totalGGR_${se}`]||(r[l][`totalGGR_${se}`]=0),r[l][`totalGGR_${se}`]+=X;const Se=new Date(r[l].maxDate),be=new Date(Se.getFullYear(),11,31);r[l].remainDays=Math.ceil((be-Se)/(1e3*60*60*24));const Te=new Date(r[l].maxDate),pe=new Date(Te);pe.setDate(pe.getDate()-6);const me=new Date(pe);me.setDate(me.getDate()-7);const ve=new Date(pe);ve.setDate(ve.getDate()-1),r[l].latestWeekStart=pe.toISOString().split("T")[0],r[l].secLatestWeekStart=me.toISOString().split("T")[0],r[l].latestWeekGGR=f.filter(W=>W.game===l&&new Date(W.summary)>=pe&&new Date(W.summary)<=Te).map(W=>W.ggrEuro),r[l].secLatestWeekGGR=f.filter(W=>W.game===l&&new Date(W.summary)>=me&&new Date(W.summary)<=ve).map(W=>W.ggrEuro),r[l].weekSum1=r[l].latestWeekGGR.reduce((W,J)=>W+J,0),r[l].weekSum2=r[l].secLatestWeekGGR.reduce((W,J)=>W+J,0),r[l].weekAverage=r[l].latestWeekGGR.reduce((W,J)=>W+J,0)/r[l].latestWeekGGR.length,r[l].weekChange=(r[l].latestWeekGGR.reduce((W,J)=>W+J,0)-r[l].secLatestWeekGGR.reduce((W,J)=>W+J,0))/r[l].secLatestWeekGGR.reduce((W,J)=>W+J,0)*100,r[l].weekChangeColor=t.jsx("span",{style:{color:r[l].weekChange>0?"green":"red"},children:`${Number(r[l].weekChange.toFixed(2)).toLocaleString()} %`}),r[l].projectedTotalGGR=r[l].totalGGR+r[l].weekAverage*r[l].remainDays,r[l].LifeTimePayout=(r[l].winsEuro/r[l].betsEuro).toFixed(2)}return r},{}));Y(H)},[f,c]);const B=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text",cell:({getValue:h,row:D})=>{const q=h();return t.jsx(re,{style:{textDecoration:"none"},to:ee?`/admin/report-one/${D.original._id}`:`/report-one/${D.original._id}`,children:q})}},{header:"Launch Date",accessorKey:"launchDate",dataType:"text",cell:({getValue:h,row:D,table:q})=>{var r;const H=h();return`${(r=H==null?void 0:H.split("T"))==null?void 0:r[0]}`}},{header:"Daily Total GGR",accessorKey:"dailyTotalGGR",dataType:"text",cell:Pe},{header:"Projected Total GGR",accessorKey:"projectedTotalGGR",dataType:"text",cell:Pe},...($==null?void 0:$.map(h=>({header:`Total GGR ${h}`,accessorKey:`totalGGR_${h}`,dataType:"text",cell:Pe})))||[],{header:"Lifetime GGR",accessorKey:"totalGGR",dataType:"text",cell:Pe},{header:"7 Day Average",accessorKey:"weekAverage",dataType:"text",cell:Pe},{header:"7 Day Change",accessorKey:"weekChangeColor",dataType:"text"},{header:"Lifetime Payout",accessorKey:"LifeTimePayout",dataType:"text"}],[$]),S=o.useMemo(()=>{const h=[];return y.forEach(D=>{const q={quarter:D};v.forEach(H=>{const r=H[`totalGGR_${D}`]!==void 0?Number(H[`totalGGR_${D}`].toFixed(2)).toLocaleString():0;q[H.name]=r}),h.push(q)}),h},[y,v]),K=o.useMemo(()=>{const h=c.map(D=>D.name);return[{header:"Quarter",accessorKey:"quarter",dataType:"text"},...h.map(D=>({header:D,accessorKey:D,dataType:"number",cell:q=>q.getValue()??0}))]},[c]);return t.jsxs(ne,{item:!0,xs:12,lg:12,children:[t.jsxs(ne,{container:!0,spacing:2,mb:5,children:[t.jsx(ne,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(b,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:"Lifetime GGR - "}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((h,D)=>h+D.totalGGR,0)).toLocaleString()})]})})}),t.jsx(ne,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(b,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:"Daily Total GGR -"}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((h,D)=>h+D.dailyTotalGGR,0)).toLocaleString()})]})})}),t.jsx(ne,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(b,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:"7 Day Average GGR -"}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((h,D)=>h+D.weekAverage,0)).toLocaleString()})]})})}),t.jsx(ne,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(b,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:"7 Day Change -"}),t.jsx(G,{variant:"h6",textAlign:"center",children:((v.reduce((h,D)=>h+D.weekSum1,0)-v.reduce((h,D)=>h+D.weekSum2,0))/v.reduce((h,D)=>h+D.weekSum2,0)*100).toFixed(2)+"%"})]})})}),t.jsx(ne,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(b,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:`Projected GGR ${$.reduce((h,D)=>Math.max(h,D),-1/0)} -`}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((h,D)=>h+D.projectedTotalGGR,0)).toLocaleString()})]})})}),t.jsx(ne,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:y==null?void 0:y.map((h,D)=>t.jsxs(b,{direction:"row",spacing:1,alignItems:"end",justifyContent:"start",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:`Total GGR ${h} - `}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((q,H)=>q+(H[`totalGGR_${h}`]||0),0)).toLocaleString()})]},D))})})]}),t.jsxs(b,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"Games Data"}),t.jsx(Ge,{data:v,columns:B})]}),t.jsxs(b,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"TOTAL GGR - QUARTER"}),t.jsx(Ge,{data:S,columns:K,setData:()=>{}})]})]})}const ye={chart:{height:100,type:"line",zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"straight",width:3},xaxis:{categories:[]}},kn=()=>{const f=ut(),[c,u]=o.useState(f.pathname==="/admin/report"),{user:ee}=Nt();o.useState(0);const[U,v]=o.useState(!1),[Y,$]=o.useState(!1),[A,y]=o.useState([]),[C,B]=o.useState([]),[S,K]=o.useState([]),[h,D]=o.useState(!0),[q,H]=o.useState(""),[r,l]=o.useState(""),[V,ce]=o.useState(!1),[de,X]=o.useState([]),[we,ue]=o.useState([]),[xe,ie]=o.useState([]),[E,w]=o.useState([]),[_,se]=o.useState([]),[Se,be]=o.useState(ye),[Te,pe]=o.useState([]),[me,ve]=o.useState(ye),[W,J]=o.useState(ye),[xt,Fe]=o.useState(ye),[Dt,$e]=o.useState(ye),[ft,Ke]=o.useState(ye),[yt,Ne]=o.useState(ye),[gt,Me]=o.useState([]),[wt,ln]=o.useState(new Date().toISOString().split("T")[0]),[jt,qe]=o.useState([]),[Gt,_e]=o.useState(ye),[St,Qe]=o.useState([]),[mt,Ye]=o.useState([]),[vt,Be]=o.useState([]),[Ct,Ve]=o.useState([]),[L,Ae]=o.useState([1,37]),[Pt,Rt]=o.useState(0),bt=rn((m,F)=>{Ae(F)},300),Tt=(m,F)=>{Ae(F),bt(m,F)},Lt=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"Launch Date",accessorKey:"launchDate",dataType:"date",cell:({getValue:m,row:F,table:g})=>{var a,i;const j=(a=g==null?void 0:g.options)==null?void 0:a.meta,De=(i=j==null?void 0:j.selectedRow)==null?void 0:i[F.id],z=m(),te=z?new Date(z).toISOString().split("T")[0]:"";return De?t.jsx("input",{type:"date",value:te,onChange:P=>j==null?void 0:j.updateData(F.index,"launchDate",P.target.value)}):te}},{header:"Actions",id:"edit",cell:pt,meta:{className:"cell-center"}}],[]),Wt=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"TOTAL GGR",accessorKey:"data",dataType:"text",cell:({getValue:m,row:F,table:g})=>{const j=m();return`${(Number(j[j.length-1])||0).toLocaleString()}`}}],[]),kt=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"GGR",accessorKey:"ggrEuro",dataType:"text"},{header:"SPINS",accessorKey:"spins",dataType:"text"},{header:"USERS",accessorKey:"uniquePlayers",dataType:"text"},{header:"SPU",accessorKey:"SPU",dataType:"text"},{header:"CWPP",accessorKey:"CWPP",dataType:"text"},{header:"Coins Wagered",accessorKey:"CW",dataType:"text"},{header:"Lifetime Payout",accessorKey:"LP",dataType:"text"}],[]),At=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"GGR",accessorKey:"ggrEuro",dataType:"text"},{header:"SPINS",accessorKey:"spins",dataType:"text"},{header:"USERS",accessorKey:"uniquePlayers",dataType:"text"},{header:"SPU",accessorKey:"SPU",dataType:"text"},{header:"CWPP",accessorKey:"CWPP",dataType:"text"}],[]),[Oe,Ot]=o.useState(null);o.useEffect(()=>{const m=[];for(let a=0;a<7;a++){const i=new Date;i.setDate(i.getDate()-a),m.push(i.toISOString().split("T")[0])}const F=C.reduce((a,{game:i,summary:P})=>{if(!a[i]){const O=S.find(R=>R.name===i);a[i]={...O,maxDate:P}}const Q=new Date(a[i].maxDate)<new Date(P);return a[i].maxDate=Q?P:a[i].maxDate,Ot(a[i].maxDate),a},{}),g={},De=Object.values(C.reduce((a,{game:i,summary:P,ggrEuro:Q,spins:O,uniquePlayers:R,betsEuro:I,winsEuro:Z})=>{a[i]||(a[i]={name:i,ggrEuro:[],spins:[],uniquePlayers:[],SPU:[],CWPP:[],CW:[],LP:[]});const k=S.find(Le=>Le.name===i);new Date(k==null?void 0:k.launchDate)<new Date(P),g[i]&&new Date(g[i])<new Date(P.split("T")[0])?g[i]=P.split("T")[0]:g[i]||(g[i]=P.split("T")[0]);const N=new Date(F[i].maxDate)||new Date,je=new Date(N);return je.setDate(je.getDate()-6),new Date(P)>=je&&new Date(P)<=N&&(a[i].ggrEuro.push(Q),a[i].spins.push(O),a[i].uniquePlayers.push(R),a[i].SPU.push(O/R),a[i].CWPP.push(I/R),a[i].CW.push(I),a[i].LP.push(Z/I)),a},{})).map(a=>{const i=a.ggrEuro,P=a.spins,Q=a.uniquePlayers,O=a.SPU,R=a.CWPP,I=a.LP,Z=a.CW;return{name:a.name,ggrEuro:Number((i.length>0?i.reduce((k,N)=>k+N,0)/i.length:0).toFixed(2)).toLocaleString(),spins:Number((P.length>0?P.reduce((k,N)=>k+N,0)/P.length:0).toFixed(2)).toLocaleString(),uniquePlayers:Number((Q.length>0?Q.reduce((k,N)=>k+N,0)/Q.length:0).toFixed(2)).toLocaleString(),SPU:Number((O.length>0?O.reduce((k,N)=>k+N,0)/O.length:0).toFixed(2)).toLocaleString(),CWPP:Number((R.length>0?R.reduce((k,N)=>k+N,0)/R.length:0).toFixed(2)).toLocaleString(),CW:Number((Z.length>0?Z.reduce((k,N)=>k+N,0)/Z.length:0).toFixed(2)).toLocaleString(),LP:Number((I.length>0?I.reduce((k,N)=>k+N,0)/I.length:0).toFixed(2)).toLocaleString()}});ie(De);const te=Object.values(C.reduce((a,{game:i,summary:P,ggrEuro:Q,spins:O,uniquePlayers:R,betsEuro:I})=>{a[i]||(a[i]={name:i,ggrEuros:[],ggrEuro:0,ggrEuro2:0,spins:0,spins2:0,uniquePlayers:0,uniquePlayers2:0,SPU:0,SPU2:0,CWPP:0,CWPP2:0,arrSpins:[],arrSpins2:[]});const Z=new Date(g[i]);Z.setDate(Z.getDate()-7);const k=new Date(g[i]);return k.setDate(k.getDate()-14),Z<new Date(P)?(a[i].ggrEuros.push(Q),a[i].arrSpins.push(O),a[i].ggrEuro+=Q,a[i].spins+=O,a[i].uniquePlayers+=R,a[i].SPU+=O/R,a[i].CWPP+=I/R):k<new Date(P)&&new Date(P)<=Z&&(a[i].arrSpins2.push(O),a[i].ggrEuro2+=Q,a[i].spins2+=O,a[i].uniquePlayers2+=R,a[i].SPU2+=O/R,a[i].CWPP2+=I/R),a},{})).map(a=>{const i=(a.ggrEuro-a.ggrEuro2)/(a.ggrEuro2||1),P=(a.spins-a.spins2)/(a.spins2||1),Q=(a.uniquePlayers-a.uniquePlayers2)/(a.uniquePlayers2||1),O=(a.SPU-a.SPU2)/(a.SPU2||1),R=(a.CWPP-a.CWPP2)/(a.CWPP2||1);return{name:a.name,ggrEuro:t.jsx("span",{style:{color:i>=0?"green":"red"},children:`${(i*100).toFixed(2)} %`}),spins:t.jsx("span",{style:{color:P>=0?"green":"red"},children:`${(P*100).toFixed(2)} %`}),uniquePlayers:t.jsx("span",{style:{color:Q>=0?"green":"red"},children:`${(Q*100).toFixed(2)} %`}),SPU:t.jsx("span",{style:{color:O>=0?"green":"red"},children:`${(O*100).toFixed(2)} %`}),CWPP:t.jsx("span",{style:{color:R>=0?"green":"red"},children:`${(R*100).toFixed(2)} %`})}});w(te)},[we,C,S]);const He=async()=>{var m,F,g;try{const j=await Re.get("api/reports");if(y(j.data.data),K(j.data.games),j.data.games.length>0){const De=j.data.games.length>0?(F=(m=j.data.games)==null?void 0:m.reduce((e,s)=>new Date(s.launchDate)<new Date(e.launchDate)?s:e).launchDate)==null?void 0:F.split("T")[0]:new Date().toISOString().split("T")[0],z=[...j.data.data].filter(e=>new Date(e.summary)>=new Date(De));z.sort((e,s)=>new Date(e.summary)-new Date(s.summary));const te=[],a=Object.values(z.reduce((e,{game:s,ggrEuro:d,summary:x})=>{e[s]||(e[s]={name:s,data:[],totalGGR:0});const p=j.data.games.find(T=>T.name===s);return e[s].totalGGR+=new Date(p==null?void 0:p.launchDate)>new Date(x)?0:d,e[s].data.push(e[s].totalGGR.toFixed(2)),te.push(x.slice(0,10)),e},{})),i=Object.values(z.reduce((e,{game:s,betsEuro:d,summary:x})=>{e[s]||(e[s]={name:s,data:[],totalCoins:0});const p=j.data.games.find(T=>T.name===s);return e[s].totalCoins+=new Date(p==null?void 0:p.launchDate)>new Date(x)?0:d,e[s].data.push(e[s].totalCoins.toFixed(2)),e},{}));let P=0;const Q=a.map(e=>(P=Math.max(P,e.data.length),{...e,data:he(e.data)})),O=i.map(e=>(P=Math.max(P,e.data.length),{...e,data:he(e.data)}));pe(O),Rt(P),Ae([1,P]),se(Q);const R=[...new Set(te)];ue(R);const I=[];for(let e=L[0];e<=L[1];e++)I.push(`Day ${e}`);const Z=(g=j.data.data)==null?void 0:g.map(e=>({...e,SPU:e.spins/e.uniquePlayers,CWPP:e.betsEuro/e.uniquePlayers}));B(Z);const k=[];for(let e=0;e<14;e++)k.push(`Day ${e+1}`);_e(e=>({...e,xaxis:{categories:k,labels:{show:!1}}})),qe(dt(a,j.data.games,R));const je=Object.values(z.reduce((e,{game:s,summary:d,uniquePlayers:x})=>{e[s]||(e[s]={name:s,data:[]});const p=j.data.games.find(T=>T.name===s);return new Date(p==null?void 0:p.launchDate)<=new Date(d)&&e[s].data.push(x),e},{})).map(e=>{const s=L[0]-1,d=L[1]-1;return e.data=e.data.slice(s,d+1),e});Qe(je);const Le=e=>{if(e.length<6)return[];let s=new Array(5).fill(0);for(let d=5;d<e.length;d++){let x=e.slice(d-4,d+1).reduce((M,le)=>M+le,0),p=e.slice(d-5,d).reduce((M,le)=>M+le,0),T=((x-p)/(p||1)*100).toFixed(2);s.push(T)}return s},ze=Object.values(z.reduce((e,{game:s,summary:d,uniquePlayers:x})=>{e[s]||(e[s]={name:s,data:[]});const p=j.data.games.find(T=>T.name===s);return new Date(p==null?void 0:p.launchDate)<=new Date(d)&&e[s].data.push(x),e},{})).map(e=>({...e,data:Le(e.data)})).map(e=>{const s=L[0]-1,d=L[1]-1;return e.data=e.data.slice(s,d+1),{...e,data:e.data}});Ye(ze);const Je=Object.values(z.reduce((e,{game:s,spins:d,summary:x})=>{e[s]||(e[s]={name:s,data:[]});const p=j.data.games.find(T=>T.name===s);return e[s].data.push(new Date(p==null?void 0:p.launchDate)>new Date(x)?0:d),e},{})).map(e=>{const s=L[0]-1,d=L[1]-1;return e.data=e.data.slice(s,d+1),{...e,data:he(e.data)}});Be(Je);const Ue=Object.values(z.reduce((e,{game:s,spins:d,uniquePlayers:x,summary:p})=>{e[s]||(e[s]={name:s,data:[]});const T=j.data.games.find(M=>M.name===s);return e[s].data.push(new Date(T==null?void 0:T.launchDate)>new Date(p)?0:(d/x).toFixed(2)),e},{})).map(e=>{const s=L[0]-1,d=L[1]-1;return e.data=e.data.slice(s,d+1),{...e,data:he(e.data)}});X(I),be(e=>({...e,xaxis:{categories:I,labels:{show:!1}}})),ve(e=>({...e,xaxis:{categories:I,labels:{show:!1}}})),J(e=>({...e,xaxis:{categories:I,labels:{show:!1}}})),Fe(e=>({...e,xaxis:{categories:I,labels:{show:!1}}})),$e(e=>({...e,xaxis:{categories:I,labels:{show:!1}}})),Ke(e=>({...e,xaxis:{categories:I,labels:{show:!1}}})),Ve(Ue);const Ee=Object.values(z.reduce((e,{game:s,summary:d,ggrEuro:x})=>{e[s]||(e[s]={name:s,data:[]});const p=j.data.games.find(Ce=>Ce.name===s),T=z.filter(Ce=>Ce.game===s).reduce((Ce,tt)=>new Date(tt.summary)>new Date(Ce)?tt.summary:Ce,"1970-01-01"),M=new Date(T),le=new Date(M);return le.setDate(le.getDate()-6),new Date(d)>=le&&new Date(d)<=M&&e[s].data.push(x),e},{})),Ie=z.reduce((e,s)=>new Date(s.summary)>new Date(e)?s.summary:e,"1970-01-01"),We=new Date(Ie),n=[];for(let e=6;e>=0;e--){const s=new Date(We);s.setDate(s.getDate()-e),n.push(s.toISOString().split("T")[0])}Me(Ee),Ne(e=>({...e,xaxis:{categories:n,labels:{show:!0}},title:{text:"7 Day GGR",align:"center"}}))}}catch{}},Ut=async()=>{const m=localStorage.getItem("reportToken");D(m!=="true"),He()};o.useEffect(()=>{Ut()},[]);const Et=async m=>{if(m.target.files.length>0){const F=m.target.files[0];if(!F){alert("Please select a file first.");return}v(!0);const g=new FormData;g.append("file",F);try{const j=await Re.post("api/reports/upload",g,{headers:{"Content-Type":"multipart/form-data"}});ke({open:!0,message:"Excel uploaded successfully!",variant:"alert",alert:{color:"success"}}),He(),v(!0)}catch(j){console.error("Upload Error:",j),alert("Error uploading file.")}finally{v(!1),m.target.value=""}}},It=async()=>{$(!0);try{const m=await Re.get("api/reports/download",{responseType:"blob"}),F=window.URL.createObjectURL(new Blob([m.data])),g=document.createElement("a");g.href=F,g.setAttribute("download","report.xlsx"),document.body.appendChild(g),g.click(),document.body.removeChild(g)}catch(m){console.error("Download Error:",m),ke({open:!0,message:"Excel not exists!",variant:"alert",alert:{color:"error"}})}finally{$(!1)}};o.useEffect(()=>{var m;if(S.length>0){const F=S.length>0?(m=S==null?void 0:S.reduce((n,e)=>new Date(e.launchDate)<new Date(n.launchDate)?e:n).launchDate)==null?void 0:m.split("T")[0]:new Date().toISOString().split("T")[0],g=[...A].filter(n=>new Date(n.summary)>=new Date(F));g.sort((n,e)=>new Date(n.summary)-new Date(e.summary));const j=[],De=Object.values(g.reduce((n,{game:e,ggrEuro:s,summary:d})=>{n[e]||(n[e]={name:e,data:[],totalGGR:0});const x=S.find(p=>p.name===e);return n[e].totalGGR+=new Date(x==null?void 0:x.launchDate)>new Date(d)?0:s,n[e].data.push(n[e].totalGGR.toFixed(2)),j.push(d.slice(0,10)),n},{})),z=Object.values(g.reduce((n,{game:e,betsEuro:s,summary:d})=>{n[e]||(n[e]={name:e,data:[],totalCoins:0});const x=S.find(p=>p.name===e);return n[e].totalCoins+=new Date(x==null?void 0:x.launchDate)>new Date(d)?0:s,n[e].data.push(n[e].totalCoins.toFixed(2)),n},{}));let te=0;const i=De.map(n=>(te=Math.max(te,n.data.length),{...n,data:he(n.data)})).map(n=>{const e=L[0]-1,s=L[1]-1;return n.data=n.data.slice(e,s+1),n}),Q=z.map(n=>(te=Math.max(te,n.data.length),{...n,data:he(n.data)})).map(n=>{const e=L[0]-1,s=L[1]-1;return n.data=n.data.slice(e,s+1),n});se(i),pe(Q);const O=[...new Set(j)];ue(O);const R=[];for(let n=L[0];n<=L[1];n++)R.push(`Day ${n}`);const I=A==null?void 0:A.map(n=>({...n,SPU:n.spins/n.uniquePlayers,CWPP:n.betsEuro/n.uniquePlayers}));B(I);const Z=[];for(let n=0;n<14;n++)Z.push(`Day ${n+1}`);_e(n=>({...n,xaxis:{categories:Z,labels:{show:!1}}})),qe(dt(De));const N=Object.values(g.reduce((n,{game:e,summary:s,uniquePlayers:d})=>{n[e]||(n[e]={name:e,data:[]});const x=S.find(p=>p.name===e);return new Date(x==null?void 0:x.launchDate)<=new Date(s)&&n[e].data.push(d),n},{})).map(n=>{const e=L[0]-1,s=L[1]-1;return n.data=n.data.slice(e,s+1),n});Qe(N);const je=n=>{if(n.length<6)return[];let e=new Array(5).fill(0);for(let s=5;s<n.length;s++){let d=n.slice(s-4,s+1).reduce((T,M)=>T+M,0),x=n.slice(s-5,s).reduce((T,M)=>T+M,0),p=((d-x)/(x||1)*100).toFixed(2);e.push(p)}return e},Xe=Object.values(g.reduce((n,{game:e,summary:s,uniquePlayers:d})=>{n[e]||(n[e]={name:e,data:[]});const x=S.find(p=>p.name===e);return new Date(x==null?void 0:x.launchDate)<=new Date(s)&&n[e].data.push(d),n},{})).map(n=>({...n,data:je(n.data)})).map(n=>{const e=L[0]-1,s=L[1]-1;return n.data=n.data.slice(e,s+1),{...n,data:n.data}});Ye(Xe);const Ze=Object.values(g.reduce((n,{game:e,spins:s,summary:d})=>{n[e]||(n[e]={name:e,data:[]});const x=S.find(p=>p.name===e);return n[e].data.push(new Date(x==null?void 0:x.launchDate)>new Date(d)?0:s),n},{})).map(n=>{const e=L[0]-1,s=L[1]-1;return n.data=n.data.slice(e,s+1),{...n,data:he(n.data)}});Be(Ze);const et=Object.values(g.reduce((n,{game:e,spins:s,uniquePlayers:d,summary:x})=>{n[e]||(n[e]={name:e,data:[]});const p=S.find(T=>T.name===e);return n[e].data.push(new Date(p==null?void 0:p.launchDate)>new Date(x)?0:(s/d).toFixed(2)),n},{})).map(n=>{const e=L[0]-1,s=L[1]-1;return n.data=n.data.slice(e,s+1),{...n,data:he(n.data)}});X(R),be(n=>({...n,xaxis:{categories:R,labels:{show:!1}}})),ve(n=>({...n,xaxis:{categories:R,labels:{show:!1}}})),J(n=>({...n,xaxis:{categories:R,labels:{show:!1}}})),Fe(n=>({...n,xaxis:{categories:R,labels:{show:!1}}})),$e(n=>({...n,xaxis:{categories:R,labels:{show:!1}}})),Ke(n=>({...n,xaxis:{categories:R,labels:{show:!1}}})),Ve(et);const Ue=Object.values(g.reduce((n,{game:e,summary:s,ggrEuro:d})=>{n[e]||(n[e]={name:e,data:[]}),S.find(M=>M.name===e);const x=g.filter(M=>M.game===e).reduce((M,le)=>new Date(le.summary)>new Date(M)?le.summary:M,"1970-01-01"),p=new Date(x),T=new Date(p);return T.setDate(T.getDate()-6),new Date(s)>=T&&new Date(s)<=p&&n[e].data.push(d),n},{})),Ee=g.reduce((n,e)=>new Date(e.summary)>new Date(n)?e.summary:n,"1970-01-01"),Ie=new Date(Ee),We=[];for(let n=6;n>=0;n--){const e=new Date(Ie);e.setDate(e.getDate()-n),We.push(e.toISOString().split("T")[0])}Me(Ue),Ne(n=>({...n,xaxis:{categories:We,labels:{show:!0}},title:{text:"7 Day GGR",align:"center"}}))}},[A,wt,S,L]);const Ft=async()=>{try{const m=await Re.post("api/account/check",{email:c?ee.email:r,password:q});localStorage.setItem("reportToken","true"),ce(!1),D(!1)}catch{ce(!0)}};return t.jsxs(Bt,{children:[t.jsx(ge,{children:!h&&t.jsxs(ne,{item:!0,xs:12,lg:12,children:[t.jsxs(b,{mb:3,spacing:1,display:"flex",flexDirection:"row",alignItems:"center",gap:2,justifyContent:"space-between",children:[t.jsx(ne,{item:!0,children:t.jsxs(b,{spacing:1,children:[t.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[t.jsxs("label",{htmlFor:"contained-button-file",children:[t.jsx(ht,{accept:".xls,.xlsx",id:"contained-button-file",type:"file",onChange:Et}),t.jsx(ot,{loading:U,variant:"contained",component:"span",children:"Upload Excel"})]}),t.jsx(ot,{sx:{marginLeft:"10px"},loading:Y,variant:"contained",component:"span",onClick:It,children:"Download Excel"})]}),t.jsxs(b,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(G,{variant:"subtitle1",color:"textSecondary",children:"Latest Report Date:"}),t.jsx(G,{variant:"subtitle1",fontWeight:"bold",children:Oe==null?void 0:Oe.split("T")[0]})]})]})}),t.jsxs(ne,{sx:{marginTop:"0px !important"},gap:2,display:"flex",flexDirection:"row",alignItems:"center",children:[t.jsx(G,{variant:"h5",textAlign:"right",children:"LAUNCH"}),t.jsx(re,{Link:!0,to:c?"/admin/report-type/users/launch":"/report-type/users/launch",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"Users"})}),t.jsx(re,{to:c?"/admin/report-type/totalGGR/launch":"/report-type/totalGGR/launch",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"Total GGR"})}),t.jsx(re,{to:c?"/admin/report-type/spinsPerUser/launch":"/report-type/spinsPerUser/launch",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"Spins Per User"})}),t.jsx(re,{to:c?"/admin/report-type/totalCoins/launch":"/report-type/totalCoins/launch",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"Total Coins"})}),t.jsx(re,{to:c?"/admin/report-type/cwpp/launch":"/report-type/cwpp/launch",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"CWPP"})})]})]}),t.jsx(b,{mb:3,spacing:1,display:"flex",flexDirection:"row",alignItems:"center",gap:2,justifyContent:"end",children:t.jsxs(ne,{sx:{marginTop:"0px !important"},gap:2,display:"flex",flexDirection:"row",alignItems:"center",children:[t.jsx(G,{variant:"h5",textAlign:"right",children:"EXCLUSIVE"}),t.jsx(re,{to:c?"/admin/report-type/users/exclusive":"/report-type/users/exclusive",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"Users"})}),t.jsx(re,{to:c?"/admin/report-type/totalGGR/exclusive":"/report-type/totalGGR/exclusive",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"Total GGR"})}),t.jsx(re,{to:c?"/admin/report-type/spinsPerUser/exclusive":"/report-type/spinsPerUser/exclusive",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"Spins Per User"})}),t.jsx(re,{to:c?"/admin/report-type/totalCoins/exclusive":"/report-type/totalCoins/exclusive",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"Total Coins"})}),t.jsx(re,{to:c?"/admin/report-type/cwpp/exclusive":"/report-type/cwpp/exclusive",children:t.jsx(ae,{loading:U,variant:"contained",component:"span",children:"CWPP"})})]})}),t.jsx(b,{mb:5,spacing:3,children:t.jsx(on,{data:A,games:S})}),t.jsxs(b,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"Launch Information"}),t.jsx(Ge,{data:S,columns:Lt,setData:K})]}),t.jsxs(b,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"TOTAL REVENUE"}),t.jsx(Ge,{data:_,columns:Wt,setData:K})]}),t.jsxs(b,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"7 Day Averages"}),t.jsx(Ge,{data:xe,columns:kt,setData:K})]}),t.jsxs(b,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"7 Day Change (%) "}),t.jsx(Ge,{data:E,columns:At,setData:K})]}),t.jsxs(b,{mb:5,direction:"row",spacing:3,alignItems:"center",justifyContent:"center",children:[t.jsx(G,{variant:"h2",children:"Time Period"}),t.jsx(sn,{getAriaLabel:()=>"Temperature range",value:L,max:Pt,min:1,onChange:Tt,valueLabelDisplay:"auto",valueLabelFormat:m=>`Day ${m}`,sx:{width:"40%"}})]}),t.jsxs(b,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"Total GGR"}),t.jsx(fe,{options:Se,series:_,type:"line",height:500})]}),t.jsxs(b,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"7 DAY GGR"}),t.jsx(fe,{options:yt,series:gt,type:"line",height:500})]}),t.jsxs(b,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"Total Coins Wagered"}),t.jsx(fe,{options:me,series:Te,type:"line",height:500})]}),t.jsxs(b,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"USERS"}),t.jsx(fe,{options:W,series:St,type:"line",height:500})]}),t.jsxs(b,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"USER 5 Day Change (%)"}),t.jsx(fe,{options:xt,series:mt,type:"line",height:500})]}),t.jsxs(b,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"SPINS PER DAY"}),t.jsx(fe,{options:Dt,series:vt,type:"line",height:500})]}),t.jsxs(b,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"SPINS PER PLAYER"}),t.jsx(fe,{options:ft,series:Ct,type:"line",height:500})]}),t.jsxs(b,{children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"14 DAY LAUNCH"}),t.jsx(fe,{options:Gt,series:jt,type:"line",height:500})]})]})}),t.jsx(Mt,{open:h,maxWidth:"xs",children:t.jsxs(qt,{sx:{p:1,py:1.5},children:[c?t.jsx(nt,{children:"Confirm Password"}):t.jsx(nt,{children:"Login"}),t.jsxs(_t,{children:[t.jsxs(b,{spacing:1,mb:2,children:[!c&&t.jsx(st,{name:"email",placeholder:"Email",type:"email",fullWidth:!0,variant:"outlined",value:r,onChange:m=>l(m.target.value)}),t.jsx(st,{name:"password",placeholder:"Password",type:"password",fullWidth:!0,variant:"outlined",value:q,onChange:m=>H(m.target.value)})]}),V&&c&&t.jsx(G,{variant:"h6",color:"red",children:"Password is wrong."}),V&&!c&&t.jsx(G,{variant:"h6",color:"red",children:"Credentials is wrong."}),"          "]}),t.jsx(Qt,{children:t.jsx(ae,{variant:"contained",onClick:Ft,children:"Confirm"})})]})})]})};export{Ge as ReactTable,kn as default,Pe as separateByComma};
