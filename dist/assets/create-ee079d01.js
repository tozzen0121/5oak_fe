import{aG as O,aI as X,aH as M,cb as he,P as Z,j as e,aY as je,M as H,c as pe,z as ue,cc as ye,aN as fe,G as n,p as s,aQ as h,ad as C,D as w,_ as ge,B as g,Q as D,aR as _,aL as ee,aM as ie,T as d,d as f,cd as Ie,a6 as be,a$ as Ce,a_ as we,aE as te,H as _e}from"./index-5d74eefe.js";import{C as Te}from"./CircularLoader-2180a3b3.js";import{A as ne,I as Ae,a as qe}from"./InvoiceModal-4d052723.js";import{i as Pe}from"./incrementer-c1985312.js";import{u as De,a as Fe,h as re,b as se,s as Se,c as B,i as ke}from"./invoice-3fc7acd5.js";import{v as de}from"./v4-4a60fe23.js";import{D as oe}from"./DatePicker-afaaf361.js";import{T as Le,a as Ne,b as Oe}from"./TableContainer-43aa5ef3.js";import{T as Me}from"./TableHead-187f43c1.js";import{T as ce}from"./TableRow-8579c9d6.js";import{T as j}from"./TableCell-700a9570.js";import{E as Be}from"./EditOutlined-4887ad1e.js";import{P as ae}from"./PlusOutlined-d2ceaf5a.js";import"./Skeleton-c69aa49b.js";import"./DeleteOutlined-937bfb7f.js";import"./InputAdornment-c90a234f.js";import"./react-pdf.browser.es-bab918ec.js";import"./index-03aca9c4.js";import"./__vite-browser-external-66d318e3.js";import"./index-3654cce3.js";import"./index-df34881d.js";import"./DownloadOutlined-49e4a119.js";import"./dateViewRenderers-d116aa33.js";import"./DesktopDatePicker-c1fea3b2.js";import"./useMobilePicker-a975bd74.js";const He=O({date:X().required("Invoice date is required"),due_date:X().when("date",(u,o)=>u&&o.min(u,"Due date can't be before invoice date")).nullable().required("Due date is required"),customerInfo:O({name:M().required("Invoice receiver information is required")}).required("Invoice receiver information is required"),status:M().required("Status selection is required"),invoice_detail:he().required("Invoice details is required").of(O().shape({name:M().required("Product name is required")})).min(1,"Invoice must have at least 1 items")}),le=({lists:u,invoiceMaster:o})=>{const p=pe(),F=ue(),T=500,S=a=>{var l,A,i;const r={id:Number(Pe(u.length)),invoice_id:Number(a.invoice_id),customer_name:(l=a.cashierInfo)==null?void 0:l.name,email:(A=a.cashierInfo)==null?void 0:A.email,avatar:Number(Math.round(Math.random()*10)),discount:Number(a.discount),tax:Number(a.tax),date:te(a.date,"MM/dd/yyyy"),due_date:te(a.due_date,"MM/dd/yyyy"),quantity:Number((i=a.invoice_detail)==null?void 0:i.reduce((k,y)=>k+y.qty,0)),status:a.status,cashierInfo:a.cashierInfo,customerInfo:a.customerInfo,invoice_detail:a.invoice_detail,notes:a.notes};ke(r),_e({open:!0,message:"Invoice Added successfully",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"alert",alert:{color:"success"}}),F("/apps/invoice/list")};return e.jsx(ye,{initialValues:{id:120,invoice_id:Date.now(),status:"",date:new Date,due_date:null,cashierInfo:{name:"Belle J. Richter",address:"1300 Cooks Mine, NM 87829",phone:"305-829-7809",email:"belljrc23@gmail.com"},customerInfo:{address:"",email:"",name:"",phone:""},invoice_detail:[{id:de(),name:"",description:"",qty:1,price:"1.00"}],discount:0,tax:0,notes:""},validationSchema:He,onSubmit:a=>{S(a)},children:({handleBlur:a,errors:r,handleChange:l,handleSubmit:A,values:i,isValid:k,setFieldValue:y,touched:x})=>{var $,z,E,R,G,W,Q,U,J;const I=i==null?void 0:i.invoice_detail.reduce((t,c)=>c.name.trim().length>0?t+Number(c.price*Math.floor(c.qty)):t,0),L=i.tax*I/100,N=i.discount*I/100,q=I-N+L;return e.jsx(fe,{onSubmit:A,children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(s,{spacing:1,children:[e.jsx(h,{children:"Invoice Id"}),e.jsx(C,{sx:{width:"100%"},children:e.jsx(w,{required:!0,disabled:!0,type:"number",name:"invoice_id",id:"invoice_id",value:i.invoice_id,onChange:l})})]})}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(s,{spacing:1,children:[e.jsx(h,{children:"Status"}),e.jsx(C,{sx:{width:"100%"},children:e.jsxs(ge,{value:i.status,displayEmpty:!0,name:"status",renderValue:t=>t.length===0?e.jsx(g,{sx:{color:"secondary.400"},children:"Select status"}):t,onChange:l,error:!!(r.status&&x.status),children:[e.jsx(D,{disabled:!0,value:"",children:"Select status"}),e.jsx(D,{value:"Paid",children:"Paid"}),e.jsx(D,{value:"Unpaid",children:"Unpaid"}),e.jsx(D,{value:"Cancelled",children:"Cancelled"})]})})]}),x.status&&r.status&&e.jsx(_,{error:!0,children:r.status})]}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(s,{spacing:1,children:[e.jsx(h,{children:"Date"}),e.jsx(C,{sx:{width:"100%"},error:!!(x.date&&r.date),children:e.jsx(ee,{dateAdapter:ie,children:e.jsx(oe,{format:"dd/MM/yyyy",value:i.date,onChange:t=>y("date",t)})})})]}),x.date&&r.date&&e.jsx(_,{error:!0,children:r.date})]}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(s,{spacing:1,children:[e.jsx(h,{children:"Due Date"}),e.jsx(C,{sx:{width:"100%"},error:!!(x.due_date&&r.due_date),children:e.jsx(ee,{dateAdapter:ie,children:e.jsx(oe,{format:"dd/MM/yyyy",value:i.due_date,onChange:t=>y("due_date",t)})})})]}),x.due_date&&r.due_date&&e.jsx(_,{error:!0,children:r.due_date})]}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(H,{sx:{minHeight:168},children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:8,children:e.jsxs(s,{spacing:2,children:[e.jsx(d,{variant:"h5",children:"From:"}),e.jsxs(s,{sx:{width:"100%"},children:[e.jsx(d,{variant:"subtitle1",children:($=i==null?void 0:i.cashierInfo)==null?void 0:$.name}),e.jsx(d,{color:"secondary",children:(z=i==null?void 0:i.cashierInfo)==null?void 0:z.address}),e.jsx(d,{color:"secondary",children:(E=i==null?void 0:i.cashierInfo)==null?void 0:E.phone}),e.jsx(d,{color:"secondary",children:(R=i==null?void 0:i.cashierInfo)==null?void 0:R.email})]})]})}),e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsxs(g,{textAlign:{xs:"left",sm:"right"},color:"grey.200",children:[e.jsx(f,{variant:"outlined",startIcon:e.jsx(Be,{}),color:"secondary",onClick:()=>re(!0),size:"small",children:"Change"}),e.jsx(ne,{open:o.open,setOpen:t=>re(t),handlerAddress:t=>y("cashierInfo",t)})]})})]})})}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(H,{sx:{minHeight:168},children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:8,children:e.jsxs(s,{spacing:2,children:[e.jsx(d,{variant:"h5",children:"To:"}),e.jsxs(s,{sx:{width:"100%"},children:[e.jsx(d,{variant:"subtitle1",children:(G=i==null?void 0:i.customerInfo)==null?void 0:G.name}),e.jsx(d,{color:"secondary",children:(W=i==null?void 0:i.customerInfo)==null?void 0:W.address}),e.jsx(d,{color:"secondary",children:(Q=i==null?void 0:i.customerInfo)==null?void 0:Q.phone}),e.jsx(d,{color:"secondary",children:(U=i==null?void 0:i.customerInfo)==null?void 0:U.email})]})]})}),e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsxs(g,{textAlign:"right",color:"grey.200",children:[e.jsx(f,{size:"small",startIcon:e.jsx(ae,{}),color:"secondary",variant:"outlined",onClick:()=>se(!0),children:"Add"}),e.jsx(ne,{open:o.isCustomerOpen,setOpen:t=>se(t),handlerAddress:t=>y("customerInfo",t)})]})})]})}),x.customerInfo&&r.customerInfo&&e.jsx(_,{error:!0,children:(J=r==null?void 0:r.customerInfo)==null?void 0:J.name})]}),e.jsx(n,{item:!0,xs:12,children:e.jsx(d,{variant:"h5",children:"Detail"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(Ie,{name:"invoice_detail",render:({remove:t,push:c})=>{var P,b,Y,v,K,V;return e.jsxs(e.Fragment,{children:[e.jsx(Le,{children:e.jsxs(Ne,{sx:{minWidth:650},children:[e.jsx(Me,{children:e.jsxs(ce,{children:[e.jsx(j,{children:"#"}),e.jsx(j,{children:"Name"}),e.jsx(j,{children:"Description"}),e.jsx(j,{children:"Qty"}),e.jsx(j,{children:"Price"}),e.jsx(j,{align:"right",children:"Amount"}),e.jsx(j,{align:"center",children:"Action"})]})}),e.jsx(Oe,{children:(P=i.invoice_detail)==null?void 0:P.map((m,xe)=>e.jsxs(ce,{children:[e.jsx(j,{children:i.invoice_detail.indexOf(m)+1}),e.jsx(Ae,{id:m.id,index:xe,name:m.name,description:m.description,qty:m.qty,price:m.price,onDeleteItem:me=>t(me),onEditItem:l,Blur:a,errors:r,touched:x},m.id)]},m.id))})]})}),e.jsx(be,{}),x.invoice_detail&&r.invoice_detail&&!Array.isArray(r==null?void 0:r.invoice_detail)&&e.jsx(s,{direction:"row",justifyContent:"center",sx:{p:1.5},children:e.jsx(_,{error:!0,children:r.invoice_detail})}),e.jsxs(n,{container:!0,justifyContent:"space-between",children:[e.jsx(n,{item:!0,xs:12,md:8,children:e.jsx(g,{sx:{pt:2.5,pr:2.5,pb:2.5,pl:0},children:e.jsx(f,{color:"primary",startIcon:e.jsx(ae,{}),onClick:()=>c({id:de(),name:"",description:"",qty:1,price:"1.00"}),variant:"dashed",sx:{bgcolor:"transparent !important"},children:"Add Item"})})}),e.jsxs(n,{item:!0,xs:12,md:4,children:[e.jsxs(n,{container:!0,justifyContent:"space-between",spacing:2,sx:{pt:2.5,pb:2.5},children:[e.jsx(n,{item:!0,xs:6,children:e.jsxs(s,{spacing:1,children:[e.jsx(h,{children:"Discount(%)"}),e.jsx(w,{type:"number",fullWidth:!0,name:"discount",id:"discount",placeholder:"0.0",value:i.discount,onChange:l,inputProps:{min:0}})]})}),e.jsx(n,{item:!0,xs:6,children:e.jsxs(s,{spacing:1,children:[e.jsx(h,{children:"Tax(%)"}),e.jsx(w,{type:"number",fullWidth:!0,name:"tax",id:"tax",placeholder:"0.0",value:i.tax,onChange:l,inputProps:{min:0}})]})})]}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(s,{spacing:2,children:[e.jsxs(s,{direction:"row",justifyContent:"space-between",children:[e.jsx(d,{color:p.palette.grey[500],children:"Sub Total:"}),e.jsx(d,{children:((b=o.country)==null?void 0:b.prefix)+""+I.toFixed(2)})]}),e.jsxs(s,{direction:"row",justifyContent:"space-between",children:[e.jsx(d,{color:p.palette.grey[500],children:"Discount:"}),e.jsx(d,{variant:"h6",color:p.palette.success.main,children:((Y=o.country)==null?void 0:Y.prefix)+""+N.toFixed(2)})]}),e.jsxs(s,{direction:"row",justifyContent:"space-between",children:[e.jsx(d,{color:p.palette.grey[500],children:"Tax:"}),e.jsx(d,{children:((v=o.country)==null?void 0:v.prefix)+""+L.toFixed(2)})]}),e.jsxs(s,{direction:"row",justifyContent:"space-between",children:[e.jsx(d,{variant:"subtitle1",children:"Grand Total:"}),e.jsx(d,{variant:"subtitle1",children:q%1===0?((K=o.country)==null?void 0:K.prefix)+""+q:((V=o.country)==null?void 0:V.prefix)+""+q.toFixed(2)})]})]})})]})]})]})}})}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(s,{spacing:1,children:[e.jsx(h,{children:"Notes"}),e.jsx(w,{placeholder:"Address",rows:3,value:i.notes,multiline:!0,name:"notes",onChange:l,inputProps:{maxLength:T},helperText:`${i.notes.length} / ${T}`,sx:{width:"100%","& .MuiFormHelperText-root":{mr:0,display:"flex",justifyContent:"flex-end"}}})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(s,{spacing:1,children:[e.jsx(h,{children:"Set Currency*"}),e.jsx(C,{sx:{width:{xs:"100%",sm:250}},children:e.jsx(Ce,{id:"country-select-demo",fullWidth:!0,options:o.countries,defaultValue:o.countries[2],value:o.countries.find(t=>{var c;return t.code===((c=o.country)==null?void 0:c.code)}),onChange:(t,c)=>Se(c),autoHighlight:!0,getOptionLabel:t=>t.label,renderOption:(t,c)=>e.jsxs(g,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...t,children:[c.code&&e.jsx("img",{loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${c.code.toLowerCase()}.png`,alt:"flag"}),c.label]}),renderInput:t=>{const c=o.countries.find(P=>{var b;return P.code===((b=o.country)==null?void 0:b.code)});return e.jsx(w,{...t,name:"phoneCode",placeholder:"Select",InputProps:{...t.InputProps,startAdornment:e.jsx(e.Fragment,{children:c&&c.code!==""&&e.jsx("img",{style:{marginRight:6},loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${c.code.toLowerCase()}.png`,alt:"flag"})})},inputProps:{...t.inputProps,autoComplete:"new-password"}})}})})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(s,{direction:"row",justifyContent:"flex-end",alignItems:"flex-end",spacing:2,sx:{height:"100%"},children:[e.jsx(f,{variant:"outlined",color:"secondary",disabled:i.status===""||!k,sx:{color:"secondary.dark"},onClick:()=>B(!0),children:"Preview"}),e.jsx(f,{variant:"outlined",color:"secondary",sx:{color:"secondary.dark"},children:"Save"}),e.jsx(f,{color:"primary",variant:"contained",type:"submit",children:"Create & Send"}),e.jsx(qe,{isOpen:o.isOpen,setIsOpen:t=>B(t),invoiceInfo:{...i,subtotal:I,taxRate:L,discountRate:N,total:q},items:i==null?void 0:i.invoice_detail,onAddNextInvoice:()=>B(!1)},i.invoice_id)]})})]})})}})};le.propTypes={lists:Z.array,invoiceMaster:Z.object};const li=()=>{const{invoice:u}=De(),{invoiceMasterLoading:o,invoiceMaster:p}=Fe(),F=o||p===void 0,T=e.jsx(g,{sx:{height:"calc(100vh - 310px)"},children:e.jsx(Te,{})});let S=[{title:"Home",to:we},{title:"Invoice",to:"/apps/invoice/dashboard"},{title:"Create Invoice"}];return e.jsxs(e.Fragment,{children:[e.jsx(je,{custom:!0,heading:"New Invoice",links:S}),e.jsx(H,{children:F?T:e.jsx(le,{lists:u,invoiceMaster:p})})]})};export{li as default};
