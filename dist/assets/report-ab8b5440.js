import{P as se,a3 as $t,r as c,j as e,M as xe,aV as ut,am as Kt,G as z,p as m,T as g,L as te,d as ee,aB as Nt,B as Mt,aO as st,aP as qt,D as nt,aS as _t,a9 as at,I as rt,Z as Qt,x as ve,H as Ue}from"./index-00d10488.js";import{C as Yt}from"./ComponentSkeleton-5bbc5a2f.js";import{L as ot}from"./LoadingButton-93f8d3d3.js";import{_ as ue}from"./react-apexcharts.min-7ad30495.js";import{u as Bt,S as Vt,f as it,b as Ht}from"./ScrollX-e2bc9460.js";import"./Filter-b1dbc46e.js";import{E as Xt,R as zt}from"./RowEditable-f05ca6a6.js";import"./LinearWithLabel-b6886e11.js";import{T as Zt,a as Jt,b as es}from"./TableContainer-a0da435a.js";import{T as ts}from"./TableHead-ebd7179a.js";import{T as lt}from"./TableRow-f96d27f6.js";import{T as ct}from"./TableCell-4b2001a9.js";import{S as ss}from"./Slider-9b568417.js";import{S as ns}from"./SendOutlined-0ee0348a.js";import"./Skeleton-a874ac2b.js";import"./DownloadOutlined-e07d659a.js";import"./CaretUpOutlined-618932a2.js";import"./CaretDownOutlined-3ae6c1e4.js";import"./Pagination-f474a403.js";import"./index-bf15d5cb.js";import"./Checkbox-3bd58a4e.js";import"./MinusOutlined-c9fb50e9.js";import"./visuallyHidden-14c3de6e.js";const pt=({row:w,table:p})=>{var A;const h=(A=p==null?void 0:p.options)==null?void 0:A.meta,re=ne=>{h==null||h.setSelectedRow(_=>({..._,[w.id]:!_[w.id]})),h==null||h.revertData(w.index,(ne==null?void 0:ne.currentTarget.name)==="cancel")},U=()=>{h==null||h.saveData(w.index)};return e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",children:[(h==null?void 0:h.selectedRow[w.id])&&e.jsx(at,{title:"Cancel",children:e.jsx(rt,{color:"error",name:"cancel",onClick:re,children:e.jsx(Qt,{})})}),e.jsx(at,{title:h!=null&&h.selectedRow[w.id]?"Save":"Edit",children:e.jsx(rt,{color:h!=null&&h.selectedRow[w.id]?"success":"primary",onClick:h!=null&&h.selectedRow[w.id]?U:re,children:h!=null&&h.selectedRow[w.id]?e.jsx(ns,{}):e.jsx(Xt,{})})})]})};pt.propTypes={row:se.object,table:se.object,options:se.array,id:se.number,index:se.number};se.node,se.number,se.number;const ht=$t("input")({display:"none"});ht.displayName="Input";const he=w=>{let p=0,h=w.length-1;for(;p<w.length&&Number(w[p])===0;)p++;for(;h>=0&&Number(w[h])===0;)h--;return w.slice(p,h+1)},dt=(w,p,h)=>w.map(U=>{const A=he(U.data);return{...U,data:A.slice(0,14)}}),Ce=({getValue:w})=>{const p=w();return`${Number((p||0).toFixed(2)).toLocaleString()}`};function ge({columns:w,data:p,setData:h}){const[re,U]=c.useState(()=>[...p]),[A,ne]=c.useState({}),_=Bt({data:p,columns:w,defaultColumn:{cell:zt},getCoreRowModel:Ht(),meta:{selectedRow:A,setSelectedRow:ne,revertData:(S,b)=>{b?h(Z=>Z.map((P,H)=>H===S?re[S]:P)):U(Z=>Z.map((P,H)=>H===S?p[S]:P))},updateData:(S,b,Z)=>{h(P=>P.map((H,u)=>u===S?{...P[S],[b]:Z}:H))},saveData:async S=>{try{const b=p[S],Z=await ve.put(`/api/launchGames/${b._id}`,b);Ue({open:!0,message:"Saved successfully!",variant:"alert",alert:{color:"success"}}),ne(P=>({...P,[S]:!1}))}catch{Ue({open:!0,message:"Error!",variant:"alert",alert:{color:"error"}})}}},debugTable:!0});let ae=[];return _.getAllColumns().map(S=>S.columnDef.accessorKey&&ae.push({label:typeof S.columnDef.header=="string"?S.columnDef.header:"#",key:S.columnDef.accessorKey})),e.jsx(xe,{content:!1,children:e.jsx(Vt,{children:e.jsx(Zt,{children:e.jsxs(Jt,{children:[e.jsx(ts,{children:_.getHeaderGroups().map(S=>e.jsx(lt,{children:S.headers.map(b=>e.jsx(ct,{...b.column.columnDef.meta,children:b.isPlaceholder?null:it(b.column.columnDef.header,b.getContext())},b.id))},S.id))}),e.jsx(es,{children:_.getRowModel().rows.map(S=>e.jsx(lt,{children:S.getVisibleCells().map(b=>e.jsx(ct,{...b.column.columnDef.meta,children:it(b.column.columnDef.cell,b.getContext())},b.id))},S.id))})]})})})})}ge.propTypes={columns:se.array,data:se.array,setData:se.func};function as({data:w,games:p}){const h=ut(),[re,U]=c.useState(h.pathname==="/admin/report"),[A,ne]=c.useState([]),[_,ae]=c.useState([]),[S,b]=c.useState([]);c.useEffect(()=>{const u=o=>{const l=o.getUTCMonth();return Math.floor(l/3)+1},x=o=>{const X=o.map(q=>new Date(q.summary)).sort((q,F)=>q-F),De=X[0],me=X[X.length-1],J=De.getFullYear(),Re=u(De),we=me.getFullYear(),be=u(me),oe=[];for(let q=J;q<=we;q++)for(let F=1;F<=4;F++)if(!(q===J&&F<Re)){if(q===we&&F>be)break;oe.push(`${q}-Q${F}`)}return oe},Q=[...new Set(w.map(o=>o.summary.split("-")[0]))];if(ae(Q),w&&w.length>0){const o=x(w);b(o)}const Y=Object.values(w.reduce((o,{game:l,summary:X,betsEuro:De,winsEuro:me,ggrEuro:J,avgBet:Re,spins:we,uniquePlayers:be})=>{o[l]||(o[l]={_id:"",name:l,maxDate:X,years:{},totalGGR:0,latestWeekStart:"",secLatestWeekStart:"",latestWeekGGR:[],secLatestWeekGGR:[],remainDays:0,weekAverage:0,weekChange:0,weekSum1:0,weekSum2:0,weekChangeColor:"",dailyTotalGGR:0,projectedTotalGGR:0,LifeTimePayout:0,betsEuro:De,winsEuro:me});const oe=p.find(q=>q.name===l);if(o[l].launchDate=oe.launchDate,o[l]._id=oe._id,console.log("gameData",oe),new Date(oe.launchDate)<=new Date(X)){const q=new Date(o[l].maxDate)<new Date(X);o[l].maxDate=q?X:o[l].maxDate,o[l].dailyTotalGGR=q?J:o[l].dailyTotalGGR,o[l].totalGGR+=J;const F=X.split("-")[0];o[l].years[F]||(o[l].years[F]=0),o[l].years[F]+=J,o[l][`totalGGR_${F}`]||(o[l][`totalGGR_${F}`]=0),o[l][`totalGGR_${F}`]+=J;const Te=u(new Date(X)),je=`${F}-Q${Te}`;o[l][`totalGGR_${je}`]||(o[l][`totalGGR_${je}`]=0),o[l][`totalGGR_${je}`]+=J;const Le=new Date(o[l].maxDate),ke=new Date(Le.getFullYear(),11,31);o[l].remainDays=Math.ceil((ke-Le)/(1e3*60*60*24));const We=new Date(o[l].maxDate),ie=new Date(We);ie.setDate(ie.getDate()-6);const Ge=new Date(ie);Ge.setDate(Ge.getDate()-7);const Pe=new Date(ie);Pe.setDate(Pe.getDate()-1),o[l].latestWeekStart=ie.toISOString().split("T")[0],o[l].secLatestWeekStart=Ge.toISOString().split("T")[0],o[l].latestWeekGGR=w.filter(T=>T.game===l&&new Date(T.summary)>=ie&&new Date(T.summary)<=We).map(T=>T.ggrEuro),o[l].secLatestWeekGGR=w.filter(T=>T.game===l&&new Date(T.summary)>=Ge&&new Date(T.summary)<=Pe).map(T=>T.ggrEuro),o[l].weekSum1=o[l].latestWeekGGR.reduce((T,B)=>T+B,0),o[l].weekSum2=o[l].secLatestWeekGGR.reduce((T,B)=>T+B,0),o[l].weekAverage=o[l].latestWeekGGR.reduce((T,B)=>T+B,0)/o[l].latestWeekGGR.length,o[l].weekChange=(o[l].latestWeekGGR.reduce((T,B)=>T+B,0)-o[l].secLatestWeekGGR.reduce((T,B)=>T+B,0))/o[l].secLatestWeekGGR.reduce((T,B)=>T+B,0)*100,o[l].weekChangeColor=e.jsx("span",{style:{color:o[l].weekChange>0?"green":"red"},children:`${Number(o[l].weekChange.toFixed(2)).toLocaleString()} %`}),o[l].projectedTotalGGR=o[l].totalGGR+o[l].weekAverage*o[l].remainDays,o[l].LifeTimePayout=(o[l].winsEuro/o[l].betsEuro).toFixed(2)}return o},{}));console.log("gameData",Y),ne(Y)},[w,p]);const Z=c.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text",cell:({getValue:u,row:x})=>{const Q=u();return e.jsx(te,{style:{textDecoration:"none"},to:re?`/admin/report-one/${x.original._id}`:`/report-one/${x.original._id}`,children:Q})}},{header:"Launch Date",accessorKey:"launchDate",dataType:"text",cell:({getValue:u,row:x,table:Q})=>{var o;const Y=u();return`${(o=Y==null?void 0:Y.split("T"))==null?void 0:o[0]}`}},{header:"Daily Total GGR",accessorKey:"dailyTotalGGR",dataType:"text",cell:Ce},{header:"Projected Total GGR",accessorKey:"projectedTotalGGR",dataType:"text",cell:Ce},...(_==null?void 0:_.map(u=>({header:`Total GGR ${u}`,accessorKey:`totalGGR_${u}`,dataType:"text",cell:Ce})))||[],{header:"Lifetime GGR",accessorKey:"totalGGR",dataType:"text",cell:Ce},{header:"7 Day Average",accessorKey:"weekAverage",dataType:"text",cell:Ce},{header:"7 Day Change",accessorKey:"weekChangeColor",dataType:"text"},{header:"Lifetime Payout",accessorKey:"LifeTimePayout",dataType:"text"}],[_]),P=c.useMemo(()=>{const u=[];return S.forEach(x=>{const Q={quarter:x};A.forEach(Y=>{const o=Y[`totalGGR_${x}`]!==void 0?Number(Y[`totalGGR_${x}`].toFixed(2)).toLocaleString():0;Q[Y.name]=o}),u.push(Q)}),u},[S,A]),H=c.useMemo(()=>{const u=p.map(x=>x.name);return[{header:"Quarter",accessorKey:"quarter",dataType:"text"},...u.map(x=>({header:x,accessorKey:x,dataType:"number",cell:Q=>Q.getValue()??0}))]},[p]);return e.jsxs(z,{item:!0,xs:12,lg:12,children:[e.jsxs(z,{container:!0,spacing:2,mb:5,children:[e.jsx(z,{item:!0,xs:6,lg:3,children:e.jsx(xe,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(m,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(g,{variant:"h5",textAlign:"center",children:"Lifetime GGR - "}),e.jsx(g,{variant:"h6",textAlign:"center",children:Number(A.reduce((u,x)=>u+x.totalGGR,0)).toLocaleString()})]})})}),e.jsx(z,{item:!0,xs:6,lg:3,children:e.jsx(xe,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(m,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(g,{variant:"h5",textAlign:"center",children:"Daily Total GGR -"}),e.jsx(g,{variant:"h6",textAlign:"center",children:Number(A.reduce((u,x)=>u+x.dailyTotalGGR,0)).toLocaleString()})]})})}),e.jsx(z,{item:!0,xs:6,lg:3,children:e.jsx(xe,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(m,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(g,{variant:"h5",textAlign:"center",children:"7 Day Average GGR -"}),e.jsx(g,{variant:"h6",textAlign:"center",children:Number(A.reduce((u,x)=>u+x.weekAverage,0)).toLocaleString()})]})})}),e.jsx(z,{item:!0,xs:6,lg:3,children:e.jsx(xe,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(m,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(g,{variant:"h5",textAlign:"center",children:"7 Day Change -"}),e.jsx(g,{variant:"h6",textAlign:"center",children:((A.reduce((u,x)=>u+x.weekSum1,0)-A.reduce((u,x)=>u+x.weekSum2,0))/A.reduce((u,x)=>u+x.weekSum2,0)*100).toFixed(2)+"%"})]})})}),e.jsx(z,{item:!0,xs:6,lg:3,children:e.jsx(xe,{sx:{height:"100%",display:"flex",alignItems:"center"},children:e.jsxs(m,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[e.jsx(g,{variant:"h5",textAlign:"center",children:`Projected GGR ${_.reduce((u,x)=>Math.max(u,x),-1/0)} -`}),e.jsx(g,{variant:"h6",textAlign:"center",children:Number(A.reduce((u,x)=>u+x.projectedTotalGGR,0)).toLocaleString()})]})})}),e.jsx(z,{item:!0,xs:6,lg:3,children:e.jsx(xe,{sx:{height:"100%",display:"flex",alignItems:"center"},children:S==null?void 0:S.map((u,x)=>e.jsxs(m,{direction:"row",spacing:1,alignItems:"end",justifyContent:"start",children:[e.jsx(g,{variant:"h5",textAlign:"center",children:`Total GGR ${u} - `}),e.jsx(g,{variant:"h6",textAlign:"center",children:Number(A.reduce((Q,Y)=>Q+(Y[`totalGGR_${u}`]||0),0)).toLocaleString()})]},x))})})]}),e.jsxs(m,{mb:5,spacing:3,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"Games Data"}),e.jsx(ge,{data:A,columns:Z})]}),e.jsxs(m,{mb:5,spacing:3,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"TOTAL GGR - QUARTER"}),e.jsx(ge,{data:P,columns:H,setData:()=>{}})]})]})}const pe={chart:{height:100,type:"line",zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"straight",width:3},xaxis:{categories:[]}},Ts=()=>{const w=ut(),[p,h]=c.useState(w.pathname==="/admin/report"),{user:re}=Kt();c.useState(0);const[U,A]=c.useState(!1),[ne,_]=c.useState(!1),[ae,S]=c.useState([]),[b,Z]=c.useState([]),[P,H]=c.useState([]),[u,x]=c.useState(!0),[Q,Y]=c.useState(""),[o,l]=c.useState(""),[X,De]=c.useState(!1),[me,J]=c.useState([]),[Re,we]=c.useState([]),[be,oe]=c.useState([]),[q,F]=c.useState([]),[Te,je]=c.useState([]),[Le,ke]=c.useState(pe),[We,ie]=c.useState([]),[Ge,Pe]=c.useState(pe),[T,B]=c.useState(pe),[xt,$e]=c.useState(pe),[Dt,Ke]=c.useState(pe),[yt,Ne]=c.useState(pe),[ft,Me]=c.useState(pe),[gt,qe]=c.useState([]),[wt,rs]=c.useState(new Date().toISOString().split("T")[0]),[jt,_e]=c.useState([]),[Gt,Qe]=c.useState(pe),[St,Ye]=c.useState([]),[mt,Be]=c.useState([]),[Pt,Ve]=c.useState([]),[Ct,He]=c.useState([]),[R,Xe]=c.useState([1,37]),[vt,Rt]=c.useState(0),bt=(G,$)=>{Xe($)},Tt=c.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"Launch Date",accessorKey:"launchDate",dataType:"date",cell:({getValue:G,row:$,table:y})=>{var a,i;const f=(a=y==null?void 0:y.options)==null?void 0:a.meta,le=(i=f==null?void 0:f.selectedRow)==null?void 0:i[$.id],K=G(),ce=K?new Date(K).toISOString().split("T")[0]:"";return le?e.jsx("input",{type:"date",value:ce,onChange:D=>f==null?void 0:f.updateData($.index,"launchDate",D.target.value)}):ce}},{header:"Actions",id:"edit",cell:pt,meta:{className:"cell-center"}}],[]),Lt=c.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"TOTAL GGR",accessorKey:"data",dataType:"text",cell:({getValue:G,row:$,table:y})=>{const f=G();return`${(Number(f[f.length-1])||0).toLocaleString()}`}}],[]),kt=c.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"GGR",accessorKey:"ggrEuro",dataType:"text"},{header:"SPINS",accessorKey:"spins",dataType:"text"},{header:"USERS",accessorKey:"uniquePlayers",dataType:"text"},{header:"SPU",accessorKey:"SPU",dataType:"text"},{header:"CWPP",accessorKey:"CWPP",dataType:"text"},{header:"Coins Wagered",accessorKey:"CW",dataType:"text"},{header:"Lifetime Payout",accessorKey:"LP",dataType:"text"}],[]),Wt=c.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"GGR",accessorKey:"ggrEuro",dataType:"text"},{header:"SPINS",accessorKey:"spins",dataType:"text"},{header:"USERS",accessorKey:"uniquePlayers",dataType:"text"},{header:"SPU",accessorKey:"SPU",dataType:"text"},{header:"CWPP",accessorKey:"CWPP",dataType:"text"}],[]),[Ee,At]=c.useState(null);c.useEffect(()=>{const G=[];for(let a=0;a<7;a++){const i=new Date;i.setDate(i.getDate()-a),G.push(i.toISOString().split("T")[0])}const $=b.reduce((a,{game:i,summary:D})=>{if(!a[i]){const k=P.find(W=>W.name===i);a[i]={...k,maxDate:D}}const E=new Date(a[i].maxDate)<new Date(D);return a[i].maxDate=E?D:a[i].maxDate,At(a[i].maxDate),a},{}),y={},le=Object.values(b.reduce((a,{game:i,summary:D,ggrEuro:E,spins:k,uniquePlayers:W,betsEuro:O,winsEuro:V})=>{a[i]||(a[i]={name:i,ggrEuro:[],spins:[],uniquePlayers:[],SPU:[],CWPP:[],CW:[],LP:[]});const L=P.find(Ae=>Ae.name===i);new Date(L==null?void 0:L.launchDate)<new Date(D),y[i]&&new Date(y[i])<new Date(D.split("T")[0])?y[i]=D.split("T")[0]:y[i]||(y[i]=D.split("T")[0]);const I=new Date($[i].maxDate)||new Date,ye=new Date(I);return ye.setDate(ye.getDate()-6),new Date(D)>=ye&&new Date(D)<=I&&(a[i].ggrEuro.push(E),a[i].spins.push(k),a[i].uniquePlayers.push(W),a[i].SPU.push(k/W),a[i].CWPP.push(O/W),a[i].CW.push(O),a[i].LP.push(V/O)),a},{})).map(a=>{const i=a.ggrEuro,D=a.spins,E=a.uniquePlayers,k=a.SPU,W=a.CWPP,O=a.LP,V=a.CW;return{name:a.name,ggrEuro:Number((i.length>0?i.reduce((L,I)=>L+I,0)/i.length:0).toFixed(2)).toLocaleString(),spins:Number((D.length>0?D.reduce((L,I)=>L+I,0)/D.length:0).toFixed(2)).toLocaleString(),uniquePlayers:Number((E.length>0?E.reduce((L,I)=>L+I,0)/E.length:0).toFixed(2)).toLocaleString(),SPU:Number((k.length>0?k.reduce((L,I)=>L+I,0)/k.length:0).toFixed(2)).toLocaleString(),CWPP:Number((W.length>0?W.reduce((L,I)=>L+I,0)/W.length:0).toFixed(2)).toLocaleString(),CW:Number((V.length>0?V.reduce((L,I)=>L+I,0)/V.length:0).toFixed(2)).toLocaleString(),LP:Number((O.length>0?O.reduce((L,I)=>L+I,0)/O.length:0).toFixed(2)).toLocaleString()}});oe(le);const ce=Object.values(b.reduce((a,{game:i,summary:D,ggrEuro:E,spins:k,uniquePlayers:W,betsEuro:O})=>{a[i]||(a[i]={name:i,ggrEuros:[],ggrEuro:0,ggrEuro2:0,spins:0,spins2:0,uniquePlayers:0,uniquePlayers2:0,SPU:0,SPU2:0,CWPP:0,CWPP2:0,arrSpins:[],arrSpins2:[]});const V=new Date(y[i]);V.setDate(V.getDate()-7);const L=new Date(y[i]);return L.setDate(L.getDate()-14),V<new Date(D)?(a[i].ggrEuros.push(E),a[i].arrSpins.push(k),a[i].ggrEuro+=E,a[i].spins+=k,a[i].uniquePlayers+=W,a[i].SPU+=k/W,a[i].CWPP+=O/W):L<new Date(D)&&new Date(D)<=V&&(a[i].arrSpins2.push(k),a[i].ggrEuro2+=E,a[i].spins2+=k,a[i].uniquePlayers2+=W,a[i].SPU2+=k/W,a[i].CWPP2+=O/W),a},{})).map(a=>{const i=(a.ggrEuro-a.ggrEuro2)/(a.ggrEuro2||1),D=(a.spins-a.spins2)/(a.spins2||1),E=(a.uniquePlayers-a.uniquePlayers2)/(a.uniquePlayers2||1),k=(a.SPU-a.SPU2)/(a.SPU2||1),W=(a.CWPP-a.CWPP2)/(a.CWPP2||1);return{name:a.name,ggrEuro:e.jsx("span",{style:{color:i>=0?"green":"red"},children:`${(i*100).toFixed(2)} %`}),spins:e.jsx("span",{style:{color:D>=0?"green":"red"},children:`${(D*100).toFixed(2)} %`}),uniquePlayers:e.jsx("span",{style:{color:E>=0?"green":"red"},children:`${(E*100).toFixed(2)} %`}),SPU:e.jsx("span",{style:{color:k>=0?"green":"red"},children:`${(k*100).toFixed(2)} %`}),CWPP:e.jsx("span",{style:{color:W>=0?"green":"red"},children:`${(W*100).toFixed(2)} %`})}});F(ce)},[Re,b,P]);const ze=async()=>{var G,$,y;try{const f=await ve.get("api/reports");if(S(f.data.data),H(f.data.games),f.data.games.length>0){const le=f.data.games.length>0?($=(G=f.data.games)==null?void 0:G.reduce((t,n)=>new Date(n.launchDate)<new Date(t.launchDate)?n:t).launchDate)==null?void 0:$.split("T")[0]:new Date().toISOString().split("T")[0],K=[...f.data.data].filter(t=>new Date(t.summary)>=new Date(le));K.sort((t,n)=>new Date(t.summary)-new Date(n.summary));const ce=[],a=Object.values(K.reduce((t,{game:n,ggrEuro:d,summary:v})=>{t[n]||(t[n]={name:n,data:[],totalGGR:0});const C=f.data.games.find(M=>M.name===n);return t[n].totalGGR+=new Date(C==null?void 0:C.launchDate)>new Date(v)?0:d,t[n].data.push(t[n].totalGGR.toFixed(2)),ce.push(v.slice(0,10)),t},{})),i=Object.values(K.reduce((t,{game:n,betsEuro:d,summary:v})=>{t[n]||(t[n]={name:n,data:[],totalCoins:0});const C=f.data.games.find(M=>M.name===n);return t[n].totalCoins+=new Date(C==null?void 0:C.launchDate)>new Date(v)?0:d,t[n].data.push(t[n].totalCoins.toFixed(2)),t},{}));let D=0;const E=a.map(t=>(D=Math.max(D,t.data.length),{...t,data:he(t.data)})),k=i.map(t=>{const n=R[0]-1,d=R[1]-1;return t.data=he(t.data).slice(n,d+1),t});Rt(D),Xe([1,D]),je(E),ie(k);const W=[...new Set(ce)];we(W);const O=[];for(let t=R[0];t<=R[1];t++)O.push(`Day ${t}`);const V=(y=f.data.data)==null?void 0:y.map(t=>({...t,SPU:t.spins/t.uniquePlayers,CWPP:t.betsEuro/t.uniquePlayers}));Z(V);const L=[];for(let t=0;t<14;t++)L.push(`Day ${t+1}`);Qe(t=>({...t,xaxis:{categories:L,labels:{show:!1}}})),_e(dt(a,f.data.games,W));const ye=Object.values(K.reduce((t,{game:n,summary:d,uniquePlayers:v})=>{t[n]||(t[n]={name:n,data:[]});const C=f.data.games.find(M=>M.name===n);return new Date(C==null?void 0:C.launchDate)<=new Date(d)&&t[n].data.push(v),t},{})).map(t=>{const n=R[0]-1,d=R[1]-1;return t.data=t.data.slice(n,d+1),t});Ye(ye);const Ae=t=>{if(t.length<6)return[];let n=new Array(5).fill(0);for(let d=5;d<t.length;d++){let v=t.slice(d-4,d+1).reduce((de,fe)=>de+fe,0),C=t.slice(d-5,d).reduce((de,fe)=>de+fe,0),M=((v-C)/(C||1)*100).toFixed(2);n.push(M)}return n},Ie=Object.values(K.reduce((t,{game:n,summary:d,uniquePlayers:v})=>{t[n]||(t[n]={name:n,data:[]});const C=f.data.games.find(M=>M.name===n);return new Date(C==null?void 0:C.launchDate)<=new Date(d)&&t[n].data.push(v),t},{})).map(t=>({...t,data:Ae(t.data)})).map(t=>{const n=R[0]-1,d=R[1]-1;return t.data=t.data.slice(n,d+1),{...t,data:t.data}});Be(Ie);const Fe=Object.values(K.reduce((t,{game:n,spins:d,summary:v})=>{t[n]||(t[n]={name:n,data:[]});const C=f.data.games.find(M=>M.name===n);return t[n].data.push(new Date(C==null?void 0:C.launchDate)>new Date(v)?0:d),t},{})).map(t=>{const n=R[0]-1,d=R[1]-1;return t.data=t.data.slice(n,d+1),{...t,data:he(t.data)}});Ve(Fe);const Oe=Object.values(K.reduce((t,{game:n,spins:d,uniquePlayers:v,summary:C})=>{t[n]||(t[n]={name:n,data:[]});const M=f.data.games.find(de=>de.name===n);return t[n].data.push(new Date(M==null?void 0:M.launchDate)>new Date(C)?0:(d/v).toFixed(2)),t},{})).map(t=>{const n=R[0]-1,d=R[1]-1;return t.data=t.data.slice(n,d+1),{...t,data:he(t.data)}});J(O),ke(t=>({...t,xaxis:{categories:O,labels:{show:!1}}})),Pe(t=>({...t,xaxis:{categories:O,labels:{show:!1}},title:{text:"Total Coins Wagered",align:"center"}})),B(t=>({...t,xaxis:{categories:O,labels:{show:!1}}})),$e(t=>({...t,xaxis:{categories:O,labels:{show:!1}}})),Ke(t=>({...t,xaxis:{categories:O,labels:{show:!1}}})),Ne(t=>({...t,xaxis:{categories:O,labels:{show:!1}}})),He(Oe);const s=Object.values(K.reduce((t,{game:n,summary:d,ggrEuro:v})=>{t[n]||(t[n]={name:n,data:[]});const C=f.data.games.find(Se=>Se.name===n),M=K.filter(Se=>Se.game===n).reduce((Se,tt)=>new Date(tt.summary)>new Date(Se)?tt.summary:Se,"1970-01-01"),de=new Date(M),fe=new Date(de);return fe.setDate(fe.getDate()-6),new Date(d)>=fe&&new Date(d)<=de&&t[n].data.push(v),t},{})),r=K.reduce((t,n)=>new Date(n.summary)>new Date(t)?n.summary:t,"1970-01-01"),j=new Date(r),N=[];for(let t=6;t>=0;t--){const n=new Date(j);n.setDate(n.getDate()-t),N.push(n.toISOString().split("T")[0])}qe(s),Me(t=>({...t,xaxis:{categories:N,labels:{show:!0}},title:{text:"7 Day GGR",align:"center"}}))}}catch{}},Ot=async()=>{const G=localStorage.getItem("reportToken");x(G!=="true"),ze()};c.useEffect(()=>{Ot()},[]);const Ut=async G=>{if(G.target.files.length>0){const $=G.target.files[0];if(!$){alert("Please select a file first.");return}A(!0);const y=new FormData;y.append("file",$);try{const f=await ve.post("api/reports/upload",y,{headers:{"Content-Type":"multipart/form-data"}});Ue({open:!0,message:"Excel uploaded successfully!",variant:"alert",alert:{color:"success"}}),ze(),A(!0)}catch(f){console.error("Upload Error:",f),alert("Error uploading file.")}finally{A(!1),G.target.value=""}}},Et=async()=>{_(!0);try{const G=await ve.get("api/reports/download",{responseType:"blob"}),$=window.URL.createObjectURL(new Blob([G.data])),y=document.createElement("a");y.href=$,y.setAttribute("download","report.xlsx"),document.body.appendChild(y),y.click(),document.body.removeChild(y)}catch(G){console.error("Download Error:",G),Ue({open:!0,message:"Excel not exists!",variant:"alert",alert:{color:"error"}})}finally{_(!1)}};c.useEffect(()=>{var G;if(P.length>0){const $=P.length>0?(G=P==null?void 0:P.reduce((s,r)=>new Date(r.launchDate)<new Date(s.launchDate)?r:s).launchDate)==null?void 0:G.split("T")[0]:new Date().toISOString().split("T")[0],y=[...ae].filter(s=>new Date(s.summary)>=new Date($));y.sort((s,r)=>new Date(s.summary)-new Date(r.summary));const f=[],le=Object.values(y.reduce((s,{game:r,ggrEuro:j,summary:N})=>{s[r]||(s[r]={name:r,data:[],totalGGR:0});const t=P.find(n=>n.name===r);return s[r].totalGGR+=new Date(t==null?void 0:t.launchDate)>new Date(N)?0:j,s[r].data.push(s[r].totalGGR.toFixed(2)),f.push(N.slice(0,10)),s},{}));let K=0;const a=le.map(s=>(K=Math.max(K,s.data.length),{...s,data:he(s.data)})).map(s=>{const r=R[0]-1,j=R[1]-1;return s.data=s.data.slice(r,j+1),s});je(a);const i=[...new Set(f)];we(i);const D=[];for(let s=R[0];s<=R[1];s++)D.push(`Day ${s}`);const E=ae==null?void 0:ae.map(s=>({...s,SPU:s.spins/s.uniquePlayers,CWPP:s.betsEuro/s.uniquePlayers}));Z(E);const k=[];for(let s=0;s<14;s++)k.push(`Day ${s+1}`);Qe(s=>({...s,xaxis:{categories:k,labels:{show:!1}}})),_e(dt(le));const O=Object.values(y.reduce((s,{game:r,summary:j,uniquePlayers:N})=>{s[r]||(s[r]={name:r,data:[]});const t=P.find(n=>n.name===r);return new Date(t==null?void 0:t.launchDate)<=new Date(j)&&s[r].data.push(N),s},{})).map(s=>{const r=R[0]-1,j=R[1]-1;return s.data=s.data.slice(r,j+1),s});Ye(O);const V=s=>{if(s.length<6)return[];let r=new Array(5).fill(0);for(let j=5;j<s.length;j++){let N=s.slice(j-4,j+1).reduce((d,v)=>d+v,0),t=s.slice(j-5,j).reduce((d,v)=>d+v,0),n=((N-t)/(t||1)*100).toFixed(2);r.push(n)}return r},ye=Object.values(y.reduce((s,{game:r,summary:j,uniquePlayers:N})=>{s[r]||(s[r]={name:r,data:[]});const t=P.find(n=>n.name===r);return new Date(t==null?void 0:t.launchDate)<=new Date(j)&&s[r].data.push(N),s},{})).map(s=>({...s,data:V(s.data)})).map(s=>{const r=R[0]-1,j=R[1]-1;return s.data=s.data.slice(r,j+1),{...s,data:s.data}});Be(ye);const Ze=Object.values(y.reduce((s,{game:r,spins:j,summary:N})=>{s[r]||(s[r]={name:r,data:[]});const t=P.find(n=>n.name===r);return s[r].data.push(new Date(t==null?void 0:t.launchDate)>new Date(N)?0:j),s},{})).map(s=>{const r=R[0]-1,j=R[1]-1;return s.data=s.data.slice(r,j+1),{...s,data:he(s.data)}});Ve(Ze);const Ie=Object.values(y.reduce((s,{game:r,spins:j,uniquePlayers:N,summary:t})=>{s[r]||(s[r]={name:r,data:[]});const n=P.find(d=>d.name===r);return s[r].data.push(new Date(n==null?void 0:n.launchDate)>new Date(t)?0:(j/N).toFixed(2)),s},{})).map(s=>{const r=R[0]-1,j=R[1]-1;return s.data=s.data.slice(r,j+1),{...s,data:he(s.data)}});J(D),ke(s=>({...s,xaxis:{categories:D,labels:{show:!1}}})),B(s=>({...s,xaxis:{categories:D,labels:{show:!1}}})),$e(s=>({...s,xaxis:{categories:D,labels:{show:!1}}})),Ke(s=>({...s,xaxis:{categories:D,labels:{show:!1}}})),Ne(s=>({...s,xaxis:{categories:D,labels:{show:!1}}})),He(Ie);const Je=Object.values(y.reduce((s,{game:r,summary:j,ggrEuro:N})=>{s[r]||(s[r]={name:r,data:[]}),P.find(v=>v.name===r);const t=y.filter(v=>v.game===r).reduce((v,C)=>new Date(C.summary)>new Date(v)?C.summary:v,"1970-01-01"),n=new Date(t),d=new Date(n);return d.setDate(d.getDate()-6),new Date(j)>=d&&new Date(j)<=n&&s[r].data.push(N),s},{})),Fe=y.reduce((s,r)=>new Date(r.summary)>new Date(s)?r.summary:s,"1970-01-01"),et=new Date(Fe),Oe=[];for(let s=6;s>=0;s--){const r=new Date(et);r.setDate(r.getDate()-s),Oe.push(r.toISOString().split("T")[0])}qe(Je),Me(s=>({...s,xaxis:{categories:Oe,labels:{show:!0}},title:{text:"7 Day GGR",align:"center"}}))}},[ae,wt,P,R]);const It=async()=>{try{const G=await ve.post("api/account/check",{email:p?re.email:o,password:Q});localStorage.setItem("reportToken","true"),De(!1),x(!1)}catch{De(!0)}};return e.jsxs(Yt,{children:[e.jsx(xe,{children:!u&&e.jsxs(z,{item:!0,xs:12,lg:12,children:[e.jsxs(m,{mb:3,spacing:1,display:"flex",flexDirection:"row",alignItems:"center",gap:2,justifyContent:"space-between",children:[e.jsx(z,{item:!0,children:e.jsxs(m,{spacing:1,children:[e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",children:[e.jsxs("label",{htmlFor:"contained-button-file",children:[e.jsx(ht,{accept:".xls,.xlsx",id:"contained-button-file",type:"file",onChange:Ut}),e.jsx(ot,{loading:U,variant:"contained",component:"span",children:"Upload Excel"})]}),e.jsx(ot,{sx:{marginLeft:"10px"},loading:ne,variant:"contained",component:"span",onClick:Et,children:"Download Excel"})]}),e.jsxs(m,{direction:"row",spacing:1,alignItems:"center",children:[e.jsx(g,{variant:"subtitle1",color:"textSecondary",children:"Latest Report Date:"}),e.jsx(g,{variant:"subtitle1",fontWeight:"bold",children:Ee==null?void 0:Ee.split("T")[0]})]})]})}),e.jsxs(z,{sx:{marginTop:"0px !important"},gap:2,display:"flex",flexDirection:"row",alignItems:"center",children:[e.jsx(g,{variant:"h5",textAlign:"right",children:"LAUNCH"}),e.jsx(te,{Link:!0,to:p?"/admin/report-type/users/launch":"/report-type/users/launch",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"Users"})}),e.jsx(te,{to:p?"/admin/report-type/totalGGR/launch":"/report-type/totalGGR/launch",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"Total GGR"})}),e.jsx(te,{to:p?"/admin/report-type/spinsPerUser/launch":"/report-type/spinsPerUser/launch",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"Spins Per User"})}),e.jsx(te,{to:p?"/admin/report-type/totalCoins/launch":"/report-type/totalCoins/launch",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"Total Coins"})}),e.jsx(te,{to:p?"/admin/report-type/cwpp/launch":"/report-type/cwpp/launch",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"CWPP"})})]})]}),e.jsx(m,{mb:3,spacing:1,display:"flex",flexDirection:"row",alignItems:"center",gap:2,justifyContent:"end",children:e.jsxs(z,{sx:{marginTop:"0px !important"},gap:2,display:"flex",flexDirection:"row",alignItems:"center",children:[e.jsx(g,{variant:"h5",textAlign:"right",children:"EXCLUSIVE"}),e.jsx(te,{to:p?"/admin/report-type/users/exclusive":"/report-type/users/exclusive",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"Users"})}),e.jsx(te,{to:p?"/admin/report-type/totalGGR/exclusive":"/report-type/totalGGR/exclusive",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"Total GGR"})}),e.jsx(te,{to:p?"/admin/report-type/spinsPerUser/exclusive":"/report-type/spinsPerUser/exclusive",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"Spins Per User"})}),e.jsx(te,{to:p?"/admin/report-type/totalCoins/exclusive":"/report-type/totalCoins/exclusive",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"Total Coins"})}),e.jsx(te,{to:p?"/admin/report-type/cwpp/exclusive":"/report-type/cwpp/exclusive",children:e.jsx(ee,{loading:U,variant:"contained",component:"span",children:"CWPP"})})]})}),e.jsx(m,{mb:5,spacing:3,children:e.jsx(as,{data:ae,games:P})}),e.jsxs(m,{mb:5,spacing:3,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"Launch Information"}),e.jsx(ge,{data:P,columns:Tt,setData:H})]}),e.jsxs(m,{mb:5,spacing:3,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"TOTAL REVENUE"}),e.jsx(ge,{data:Te,columns:Lt,setData:H})]}),e.jsxs(m,{mb:5,spacing:3,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"7 Day Averages"}),e.jsx(ge,{data:be,columns:kt,setData:H})]}),e.jsxs(m,{mb:5,spacing:3,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"7 Day Change (%) "}),e.jsx(ge,{data:q,columns:Wt,setData:H})]}),e.jsxs(m,{mb:5,direction:"row",spacing:3,alignItems:"center",justifyContent:"center",children:[e.jsx(g,{variant:"h2",children:"Time Period"}),e.jsx(ss,{getAriaLabel:()=>"Temperature range",value:R,max:vt,min:1,onChange:bt,valueLabelDisplay:"auto",valueLabelFormat:G=>`Day ${G}`,sx:{width:"40%"}})]}),e.jsxs(m,{mb:5,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"Total GGR"}),e.jsx(ue,{options:Le,series:Te,type:"line",height:500})]}),e.jsxs(m,{mb:5,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"7 DAY GGR"}),e.jsx(ue,{options:ft,series:gt,type:"line",height:500})]}),e.jsxs(m,{mb:5,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"Total Coins Wagered"}),e.jsx(ue,{options:Ge,series:We,type:"line",height:500})]}),e.jsxs(m,{mb:5,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"USERS"}),e.jsx(ue,{options:T,series:St,type:"line",height:500})]}),e.jsxs(m,{mb:5,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"USER 5 Day Change (%)"}),e.jsx(ue,{options:xt,series:mt,type:"line",height:500})]}),e.jsxs(m,{mb:5,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"SPINS PER DAY"}),e.jsx(ue,{options:Dt,series:Pt,type:"line",height:500})]}),e.jsxs(m,{mb:5,children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"SPINS PER PLAYER"}),e.jsx(ue,{options:yt,series:Ct,type:"line",height:500})]}),e.jsxs(m,{children:[e.jsx(g,{variant:"h2",textAlign:"center",children:"14 DAY LAUNCH"}),e.jsx(ue,{options:Gt,series:jt,type:"line",height:500})]})]})}),e.jsx(Nt,{open:u,maxWidth:"xs",children:e.jsxs(Mt,{sx:{p:1,py:1.5},children:[p?e.jsx(st,{children:"Confirm Password"}):e.jsx(st,{children:"Login"}),e.jsxs(qt,{children:[e.jsxs(m,{spacing:1,mb:2,children:[!p&&e.jsx(nt,{name:"email",placeholder:"Email",type:"email",fullWidth:!0,variant:"outlined",value:o,onChange:G=>l(G.target.value)}),e.jsx(nt,{name:"password",placeholder:"Password",type:"password",fullWidth:!0,variant:"outlined",value:Q,onChange:G=>Y(G.target.value)})]}),X&&p&&e.jsx(g,{variant:"h6",color:"red",children:"Password is wrong."}),X&&!p&&e.jsx(g,{variant:"h6",color:"red",children:"Credentials is wrong."}),"          "]}),e.jsx(_t,{children:e.jsx(ee,{variant:"contained",onClick:It,children:"Confirm"})})]})})]})};export{ge as ReactTable,Ts as default,Ce as separateByComma};
