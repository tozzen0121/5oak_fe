import{r as o,P as re,a3 as Nt,j as t,M as ge,aV as pt,am as Mt,G as te,p as R,T as G,L as ae,d as se,aB as qt,B as _t,aO as st,aP as Qt,D as at,aS as Yt,a9 as rt,I as ot,Z as Bt,x as Te,H as Ae}from"./index-0e2d5618.js";import{C as Vt}from"./ComponentSkeleton-ec647e24.js";import{L as it}from"./LoadingButton-82cee0fa.js";import{_ as De}from"./react-apexcharts.min-3d32659d.js";import{u as Ht,S as Xt,f as lt,b as zt}from"./ScrollX-a263adcd.js";import"./Filter-1872dd20.js";import{E as Zt,R as Jt}from"./RowEditable-7f5efad0.js";import"./LinearWithLabel-45a7e8f5.js";import{T as en,a as tn,b as nn}from"./TableContainer-8a9c42b1.js";import{T as sn}from"./TableHead-eb5e4aaa.js";import{T as ct}from"./TableRow-fde806e0.js";import{T as dt}from"./TableCell-4bb39d30.js";import{S as an}from"./Slider-a48c6886.js";import{S as rn}from"./SendOutlined-318b7bfd.js";import"./Skeleton-c1bb4e34.js";import"./DownloadOutlined-661b3796.js";import"./CaretUpOutlined-982b7bf6.js";import"./CaretDownOutlined-53349dd6.js";import"./Pagination-c77b8c72.js";import"./index-594713b3.js";import"./Checkbox-48da1547.js";import"./MinusOutlined-99b6f69a.js";import"./visuallyHidden-14c3de6e.js";function on(f,c,p,ee){var E=this,v=o.useRef(null),B=o.useRef(0),M=o.useRef(0),k=o.useRef(null),y=o.useRef([]),C=o.useRef(),V=o.useRef(),w=o.useRef(f),q=o.useRef(!0);w.current=f;var h=typeof window<"u",D=!c&&c!==0&&h;if(typeof f!="function")throw new TypeError("Expected a function");c=+c||0;var Q=!!(p=p||{}).leading,X=!("trailing"in p)||!!p.trailing,r="maxWait"in p,l="debounceOnServer"in p&&!!p.debounceOnServer,H=r?Math.max(+p.maxWait||0,c):null;o.useEffect(function(){return q.current=!0,function(){q.current=!1}},[]);var le=o.useMemo(function(){var ce=function(j){var Y=y.current,ne=C.current;return y.current=C.current=null,B.current=j,M.current=M.current||j,V.current=w.current.apply(ne,Y)},z=function(j,Y){D&&cancelAnimationFrame(k.current),k.current=D?requestAnimationFrame(j):setTimeout(j,Y)},we=function(j){if(!q.current)return!1;var Y=j-v.current;return!v.current||Y>=c||Y<0||r&&j-B.current>=H},de=function(j){return k.current=null,X&&y.current?ce(j):(y.current=C.current=null,V.current)},he=function j(){var Y=Date.now();if(Q&&M.current===B.current&&oe(),we(Y))return de(Y);if(q.current){var ne=c-(Y-v.current),Ge=r?Math.min(ne,H-(Y-B.current)):ne;z(j,Ge)}},oe=function(){ee&&ee({})},I=function(){if(h||l){var j=Date.now(),Y=we(j);if(y.current=[].slice.call(arguments),C.current=E,v.current=j,Y){if(!k.current&&q.current)return B.current=v.current,z(he,c),Q?ce(v.current):V.current;if(r)return z(he,c),ce(v.current)}return k.current||z(he,c),V.current}};return I.cancel=function(){k.current&&(D?cancelAnimationFrame(k.current):clearTimeout(k.current)),B.current=0,y.current=v.current=C.current=k.current=null},I.isPending=function(){return!!k.current},I.flush=function(){return k.current?de(Date.now()):V.current},I},[Q,r,c,H,X,D,h,l,ee]);return le}const ht=({row:f,table:c})=>{var v;const p=(v=c==null?void 0:c.options)==null?void 0:v.meta,ee=B=>{p==null||p.setSelectedRow(M=>({...M,[f.id]:!M[f.id]})),p==null||p.revertData(f.index,(B==null?void 0:B.currentTarget.name)==="cancel")},E=()=>{p==null||p.saveData(f.index)};return t.jsxs(R,{direction:"row",spacing:1,alignItems:"center",children:[(p==null?void 0:p.selectedRow[f.id])&&t.jsx(rt,{title:"Cancel",children:t.jsx(ot,{color:"error",name:"cancel",onClick:ee,children:t.jsx(Bt,{})})}),t.jsx(rt,{title:p!=null&&p.selectedRow[f.id]?"Save":"Edit",children:t.jsx(ot,{color:p!=null&&p.selectedRow[f.id]?"success":"primary",onClick:p!=null&&p.selectedRow[f.id]?E:ee,children:p!=null&&p.selectedRow[f.id]?t.jsx(rn,{}):t.jsx(Zt,{})})})]})};ht.propTypes={row:re.object,table:re.object,options:re.array,id:re.number,index:re.number};re.node,re.number,re.number;const xt=Nt("input")({display:"none"});xt.displayName="Input";const ye=f=>{let c=0,p=f.length-1;for(;c<f.length&&Number(f[c])===0;)c++;for(;p>=0&&Number(f[p])===0;)p--;return f.slice(c,p+1)},ut=(f,c,p)=>f.map(E=>{const v=ye(E.data);return{...E,data:v.slice(0,14)}}),Re=({getValue:f})=>{const c=f();return`${Number((c||0).toFixed(2)).toLocaleString()}`};function je({columns:f,data:c,setData:p}){const[ee,E]=o.useState(()=>[...c]),[v,B]=o.useState({}),M=Ht({data:c,columns:f,defaultColumn:{cell:Jt},getCoreRowModel:zt(),meta:{selectedRow:v,setSelectedRow:B,revertData:(y,C)=>{C?p(V=>V.map((w,q)=>q===y?ee[y]:w)):E(V=>V.map((w,q)=>q===y?c[y]:w))},updateData:(y,C,V)=>{p(w=>w.map((q,h)=>h===y?{...w[y],[C]:V}:q))},saveData:async y=>{try{const C=c[y],V=await Te.put(`/api/launchGames/${C._id}`,C);Ae({open:!0,message:"Saved successfully!",variant:"alert",alert:{color:"success"}}),B(w=>({...w,[y]:!1}))}catch{Ae({open:!0,message:"Error!",variant:"alert",alert:{color:"error"}})}}},debugTable:!0});let k=[];return M.getAllColumns().map(y=>y.columnDef.accessorKey&&k.push({label:typeof y.columnDef.header=="string"?y.columnDef.header:"#",key:y.columnDef.accessorKey})),t.jsx(ge,{content:!1,children:t.jsx(Xt,{children:t.jsx(en,{children:t.jsxs(tn,{children:[t.jsx(sn,{children:M.getHeaderGroups().map(y=>t.jsx(ct,{children:y.headers.map(C=>t.jsx(dt,{...C.column.columnDef.meta,children:C.isPlaceholder?null:lt(C.column.columnDef.header,C.getContext())},C.id))},y.id))}),t.jsx(nn,{children:M.getRowModel().rows.map(y=>t.jsx(ct,{children:y.getVisibleCells().map(C=>t.jsx(dt,{...C.column.columnDef.meta,children:lt(C.column.columnDef.cell,C.getContext())},C.id))},y.id))})]})})})})}je.propTypes={columns:re.array,data:re.array,setData:re.func};function ln({data:f,games:c}){const p=pt(),[ee,E]=o.useState(p.pathname==="/admin/report"),[v,B]=o.useState([]),[M,k]=o.useState([]),[y,C]=o.useState([]);o.useEffect(()=>{const h=r=>{const l=r.getUTCMonth();return Math.floor(l/3)+1},D=r=>{const H=r.map(I=>new Date(I.summary)).sort((I,j)=>I-j),le=H[0],ce=H[H.length-1],z=le.getFullYear(),we=h(le),de=ce.getFullYear(),he=h(ce),oe=[];for(let I=z;I<=de;I++)for(let j=1;j<=4;j++)if(!(I===z&&j<we)){if(I===de&&j>he)break;oe.push(`${I}-Q${j}`)}return oe},Q=[...new Set(f.map(r=>r.summary.split("-")[0]))];if(k(Q),f&&f.length>0){const r=D(f);C(r)}const X=Object.values(f.reduce((r,{game:l,summary:H,betsEuro:le,winsEuro:ce,ggrEuro:z,avgBet:we,spins:de,uniquePlayers:he})=>{r[l]||(r[l]={_id:"",name:l,maxDate:H,years:{},totalGGR:0,latestWeekStart:"",secLatestWeekStart:"",latestWeekGGR:[],secLatestWeekGGR:[],remainDays:0,weekAverage:0,weekChange:0,weekSum1:0,weekSum2:0,weekChangeColor:"",dailyTotalGGR:0,projectedTotalGGR:0,LifeTimePayout:0,betsEuro:le,winsEuro:ce});const oe=c.find(I=>I.name===l);if(r[l].launchDate=oe.launchDate,r[l]._id=oe._id,new Date(oe.launchDate)<=new Date(H)){const I=new Date(r[l].maxDate)<new Date(H);r[l].maxDate=I?H:r[l].maxDate,r[l].dailyTotalGGR=I?z:r[l].dailyTotalGGR,r[l].totalGGR+=z;const j=H.split("-")[0];r[l].years[j]||(r[l].years[j]=0),r[l].years[j]+=z,r[l][`totalGGR_${j}`]||(r[l][`totalGGR_${j}`]=0),r[l][`totalGGR_${j}`]+=z;const Y=h(new Date(H)),ne=`${j}-Q${Y}`;r[l][`totalGGR_${ne}`]||(r[l][`totalGGR_${ne}`]=0),r[l][`totalGGR_${ne}`]+=z;const Ge=new Date(r[l].maxDate),be=new Date(Ge.getFullYear(),11,31);r[l].remainDays=Math.ceil((be-Ge)/(1e3*60*60*24));const Le=new Date(r[l].maxDate),ue=new Date(Le);ue.setDate(ue.getDate()-6);const me=new Date(ue);me.setDate(me.getDate()-7);const Se=new Date(ue);Se.setDate(Se.getDate()-1),r[l].latestWeekStart=ue.toISOString().split("T")[0],r[l].secLatestWeekStart=me.toISOString().split("T")[0],r[l].latestWeekGGR=f.filter(W=>W.game===l&&new Date(W.summary)>=ue&&new Date(W.summary)<=Le).map(W=>W.ggrEuro),r[l].secLatestWeekGGR=f.filter(W=>W.game===l&&new Date(W.summary)>=me&&new Date(W.summary)<=Se).map(W=>W.ggrEuro),r[l].weekSum1=r[l].latestWeekGGR.reduce((W,J)=>W+J,0),r[l].weekSum2=r[l].secLatestWeekGGR.reduce((W,J)=>W+J,0),r[l].weekAverage=r[l].latestWeekGGR.reduce((W,J)=>W+J,0)/r[l].latestWeekGGR.length,r[l].weekChange=(r[l].latestWeekGGR.reduce((W,J)=>W+J,0)-r[l].secLatestWeekGGR.reduce((W,J)=>W+J,0))/r[l].secLatestWeekGGR.reduce((W,J)=>W+J,0)*100,r[l].weekChangeColor=t.jsx("span",{style:{color:r[l].weekChange>0?"green":"red"},children:`${Number(r[l].weekChange.toFixed(2)).toLocaleString()} %`}),r[l].projectedTotalGGR=r[l].totalGGR+r[l].weekAverage*r[l].remainDays,r[l].LifeTimePayout=(r[l].winsEuro/r[l].betsEuro).toFixed(2)}return r},{}));B(X)},[f,c]);const V=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text",cell:({getValue:h,row:D})=>{const Q=h();return t.jsx(ae,{style:{textDecoration:"none"},to:ee?`/admin/report-one/${D.original._id}`:`/report-one/${D.original._id}`,children:Q})}},{header:"Launch Date",accessorKey:"launchDate",dataType:"text",cell:({getValue:h,row:D,table:Q})=>{var r;const X=h();return`${(r=X==null?void 0:X.split("T"))==null?void 0:r[0]}`}},{header:"Daily Total GGR",accessorKey:"dailyTotalGGR",dataType:"text",cell:Re},{header:"Projected Total GGR",accessorKey:"projectedTotalGGR",dataType:"text",cell:Re},...(M==null?void 0:M.map(h=>({header:`Total GGR ${h}`,accessorKey:`totalGGR_${h}`,dataType:"text",cell:Re})))||[],{header:"Lifetime GGR",accessorKey:"totalGGR",dataType:"text",cell:Re},{header:"7 Day Average",accessorKey:"weekAverage",dataType:"text",cell:Re},{header:"7 Day Change",accessorKey:"weekChangeColor",dataType:"text"},{header:"Lifetime Payout",accessorKey:"LifeTimePayout",dataType:"text"}],[M]),w=o.useMemo(()=>{const h=[];return y.forEach(D=>{const Q={quarter:D};v.forEach(X=>{const r=X[`totalGGR_${D}`]!==void 0?Number(X[`totalGGR_${D}`].toFixed(2)).toLocaleString():0;Q[X.name]=r}),h.push(Q)}),h},[y,v]),q=o.useMemo(()=>{const h=c.map(D=>D.name);return[{header:"Quarter",accessorKey:"quarter",dataType:"text"},...h.map(D=>({header:D,accessorKey:D,dataType:"number",cell:Q=>Q.getValue()??0}))]},[c]);return t.jsxs(te,{item:!0,xs:12,lg:12,children:[t.jsxs(te,{container:!0,spacing:2,mb:5,children:[t.jsx(te,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(R,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:"Lifetime GGR - "}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((h,D)=>h+D.totalGGR,0)).toLocaleString()})]})})}),t.jsx(te,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(R,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:"Daily Total GGR -"}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((h,D)=>h+D.dailyTotalGGR,0)).toLocaleString()})]})})}),t.jsx(te,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(R,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:"7 Day Average GGR -"}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((h,D)=>h+D.weekAverage,0)).toLocaleString()})]})})}),t.jsx(te,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(R,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:"7 Day Change -"}),t.jsx(G,{variant:"h6",textAlign:"center",children:((v.reduce((h,D)=>h+D.weekSum1,0)-v.reduce((h,D)=>h+D.weekSum2,0))/v.reduce((h,D)=>h+D.weekSum2,0)*100).toFixed(2)+"%"})]})})}),t.jsx(te,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:t.jsxs(R,{direction:"row",spacing:1,alignItems:"end",justifyContent:"center",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:`Projected GGR ${M.reduce((h,D)=>Math.max(h,D),-1/0)} -`}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((h,D)=>h+D.projectedTotalGGR,0)).toLocaleString()})]})})}),t.jsx(te,{item:!0,xs:6,lg:3,children:t.jsx(ge,{sx:{height:"100%",display:"flex",alignItems:"center"},children:y==null?void 0:y.map((h,D)=>t.jsxs(R,{direction:"row",spacing:1,alignItems:"end",justifyContent:"start",children:[t.jsx(G,{variant:"h5",textAlign:"center",children:`Total GGR ${h} - `}),t.jsx(G,{variant:"h6",textAlign:"center",children:Number(v.reduce((Q,X)=>Q+(X[`totalGGR_${h}`]||0),0)).toLocaleString()})]},D))})})]}),t.jsxs(R,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"Games Data"}),t.jsx(je,{data:v,columns:V})]}),t.jsxs(R,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"TOTAL GGR - QUARTER"}),t.jsx(je,{data:w,columns:q,setData:()=>{}})]})]})}const fe={chart:{height:100,type:"line",zoom:{enabled:!1}},dataLabels:{enabled:!1},stroke:{curve:"straight",width:3},xaxis:{categories:[]}},kn=()=>{const f=pt(),[c,p]=o.useState(f.pathname==="/admin/report"),{user:ee}=Mt();o.useState(0);const[E,v]=o.useState(!1),[B,M]=o.useState(!1),[k,y]=o.useState([]),[C,V]=o.useState([]),[w,q]=o.useState([]),[h,D]=o.useState(!0),[Q,X]=o.useState(""),[r,l]=o.useState(""),[H,le]=o.useState(!1),[ce,z]=o.useState([]),[we,de]=o.useState([]),[he,oe]=o.useState([]),[I,j]=o.useState([]),[Y,ne]=o.useState([]),[Ge,be]=o.useState(fe),[Le,ue]=o.useState([]),[me,Se]=o.useState(fe),[W,J]=o.useState(fe),[Dt,Fe]=o.useState(fe),[ft,$e]=o.useState(fe),[yt,Ke]=o.useState(fe),[gt,Ne]=o.useState(fe),[wt,Me]=o.useState([]),[jt,cn]=o.useState(new Date().toISOString().split("T")[0]),[Gt,qe]=o.useState([]),[mt,_e]=o.useState(fe),[St,Qe]=o.useState([]),[vt,Ye]=o.useState([]),[Ct,Be]=o.useState([]),[Pt,Ve]=o.useState([]),[T,ke]=o.useState([1,37]),[Rt,Tt]=o.useState(0),bt=on((m,$)=>{ke($)},300),Lt=(m,$)=>{ke($),bt(m,$)},Wt=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"Launch Date",accessorKey:"launchDate",dataType:"date",cell:({getValue:m,row:$,table:g})=>{var a,i;const S=(a=g==null?void 0:g.options)==null?void 0:a.meta,xe=(i=S==null?void 0:S.selectedRow)==null?void 0:i[$.id],Z=m(),pe=Z?new Date(Z).toISOString().split("T")[0]:"";return xe?t.jsx("input",{type:"date",value:pe,onChange:b=>S==null?void 0:S.updateData($.index,"launchDate",b.target.value)}):pe}},{header:"Actions",id:"edit",cell:ht,meta:{className:"cell-center"}}],[]),At=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"TOTAL GGR",accessorKey:"data",dataType:"text",cell:({getValue:m,row:$,table:g})=>{const S=m();return`${(Number(S[S.length-1])||0).toLocaleString()}`}}],[]),kt=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"GGR",accessorKey:"ggrEuro",dataType:"text"},{header:"SPINS",accessorKey:"spins",dataType:"text"},{header:"USERS",accessorKey:"uniquePlayers",dataType:"text"},{header:"SPU",accessorKey:"SPU",dataType:"text"},{header:"CWPP",accessorKey:"CWPP",dataType:"text"},{header:"Coins Wagered",accessorKey:"CW",dataType:"text"},{header:"Lifetime Payout",accessorKey:"LP",dataType:"text"}],[]),Ot=o.useMemo(()=>[{header:"Game",accessorKey:"name",dataType:"text"},{header:"GGR",accessorKey:"ggrEuro",dataType:"text"},{header:"SPINS",accessorKey:"spins",dataType:"text"},{header:"USERS",accessorKey:"uniquePlayers",dataType:"text"},{header:"SPU",accessorKey:"SPU",dataType:"text"},{header:"CWPP",accessorKey:"CWPP",dataType:"text"}],[]),[Oe,Ut]=o.useState(null);o.useEffect(()=>{const m=[];for(let a=0;a<7;a++){const i=new Date;i.setDate(i.getDate()-a),m.push(i.toISOString().split("T")[0])}const $=C.reduce((a,{game:i,summary:b})=>{if(!a[i]){const O=w.find(A=>A.name===i);a[i]={...O,maxDate:b}}const K=new Date(a[i].maxDate)<new Date(b);return a[i].maxDate=K?b:a[i].maxDate,Ut(a[i].maxDate),a},{}),g={},xe=Object.values(C.reduce((a,{game:i,summary:b,ggrEuro:K,spins:O,uniquePlayers:A,betsEuro:U,winsEuro:F})=>{a[i]||(a[i]={name:i,ggrEuro:[],spins:[],uniquePlayers:[],SPU:[],CWPP:[],CW:[],LP:[]});const L=w.find(Pe=>Pe.name===i);new Date(L==null?void 0:L.launchDate)<new Date(b),g[i]&&new Date(g[i])<new Date(b.split("T")[0])?g[i]=b.split("T")[0]:g[i]||(g[i]=b.split("T")[0]);const N=new Date($[i].maxDate)||new Date,ve=new Date(N);return ve.setDate(ve.getDate()-6),new Date(b)>=ve&&new Date(b)<=N&&(a[i].ggrEuro.push(K),a[i].spins.push(O),a[i].uniquePlayers.push(A),a[i].SPU.push(O/A),a[i].CWPP.push(U/A),a[i].CW.push(U),a[i].LP.push(F/U)),a},{})).map(a=>{const i=a.ggrEuro,b=a.spins,K=a.uniquePlayers,O=a.SPU,A=a.CWPP,U=a.LP,F=a.CW;return{name:a.name,ggrEuro:Number((i.length>0?i.reduce((L,N)=>L+N,0)/i.length:0).toFixed(2)).toLocaleString(),spins:Number((b.length>0?b.reduce((L,N)=>L+N,0)/b.length:0).toFixed(2)).toLocaleString(),uniquePlayers:Number((K.length>0?K.reduce((L,N)=>L+N,0)/K.length:0).toFixed(2)).toLocaleString(),SPU:Number((O.length>0?O.reduce((L,N)=>L+N,0)/O.length:0).toFixed(2)).toLocaleString(),CWPP:Number((A.length>0?A.reduce((L,N)=>L+N,0)/A.length:0).toFixed(2)).toLocaleString(),CW:Number((F.length>0?F.reduce((L,N)=>L+N,0)/F.length:0).toFixed(2)).toLocaleString(),LP:Number((U.length>0?U.reduce((L,N)=>L+N,0)/U.length:0).toFixed(2)).toLocaleString()}});oe(xe);const pe=Object.values(C.reduce((a,{game:i,summary:b,ggrEuro:K,spins:O,uniquePlayers:A,betsEuro:U})=>{a[i]||(a[i]={name:i,ggrEuros:[],ggrEuro:0,ggrEuro2:0,spins:0,spins2:0,uniquePlayers:0,uniquePlayers2:0,SPU:0,SPU2:0,CWPP:0,CWPP2:0,arrSpins:[],arrSpins2:[]});const F=new Date(g[i]);F.setDate(F.getDate()-7);const L=new Date(g[i]);return L.setDate(L.getDate()-14),F<new Date(b)?(a[i].ggrEuros.push(K),a[i].arrSpins.push(O),a[i].ggrEuro+=K,a[i].spins+=O,a[i].uniquePlayers+=A,a[i].SPU+=O/A,a[i].CWPP+=U/A):L<new Date(b)&&new Date(b)<=F&&(a[i].arrSpins2.push(O),a[i].ggrEuro2+=K,a[i].spins2+=O,a[i].uniquePlayers2+=A,a[i].SPU2+=O/A,a[i].CWPP2+=U/A),a},{})).map(a=>{const i=(a.ggrEuro-a.ggrEuro2)/(a.ggrEuro2||1),b=(a.spins-a.spins2)/(a.spins2||1),K=(a.uniquePlayers-a.uniquePlayers2)/(a.uniquePlayers2||1),O=(a.SPU-a.SPU2)/(a.SPU2||1),A=(a.CWPP-a.CWPP2)/(a.CWPP2||1);return{name:a.name,ggrEuro:t.jsx("span",{style:{color:i>=0?"green":"red"},children:`${(i*100).toFixed(2)} %`}),spins:t.jsx("span",{style:{color:b>=0?"green":"red"},children:`${(b*100).toFixed(2)} %`}),uniquePlayers:t.jsx("span",{style:{color:K>=0?"green":"red"},children:`${(K*100).toFixed(2)} %`}),SPU:t.jsx("span",{style:{color:O>=0?"green":"red"},children:`${(O*100).toFixed(2)} %`}),CWPP:t.jsx("span",{style:{color:A>=0?"green":"red"},children:`${(A*100).toFixed(2)} %`})}});j(pe)},[we,C,w]);const He=async()=>{var m,$,g;try{const S=await Te.get("api/reports");if(y(S.data.data),q(S.data.games),S.data.games.length>0){const xe=S.data.games.length>0?($=(m=S.data.games)==null?void 0:m.reduce((e,s)=>new Date(s.launchDate)<new Date(e.launchDate)?s:e).launchDate)==null?void 0:$.split("T")[0]:new Date().toISOString().split("T")[0],Z=[...S.data.data].filter(e=>new Date(e.summary)>=new Date(xe));Z.sort((e,s)=>new Date(e.summary)-new Date(s.summary));const pe=[],a=Object.values(Z.reduce((e,{game:s,ggrEuro:d,summary:x})=>{e[s]||(e[s]={name:s,data:[],totalGGR:0});const u=S.data.games.find(P=>P.name===s);return e[s].totalGGR+=new Date(u==null?void 0:u.launchDate)>new Date(x)?0:d,e[s].data.push(e[s].totalGGR.toFixed(2)),pe.push(x.slice(0,10)),e},{})),i=Z.reduce((e,{summary:s,betsEuro:d,game:x})=>{const u=w.find(P=>P.name===x);if(new Date(u==null?void 0:u.launchDate)<=new Date(s)){const P=s.slice(0,10);e[P]||(e[P]=0),e[P]+=d}return e},{}),b=[{name:"Total Coins Wagered",data:Object.entries(i).sort(([e],[s])=>new Date(e)-new Date(s)).map(([e,s])=>Number(s.toFixed(2)))}];let K=0;const O=a.map(e=>(K=Math.max(K,e.data.length),{...e,data:ye(e.data)})),A=b.map(e=>{const s=T[0]-1,d=T[1]-1;return e.data=e.data.slice(s,d+1),e});Tt(K),ke([1,K]),ne(O),ue(A);const U=[...new Set(pe)];de(U);const F=[];for(let e=T[0];e<=T[1];e++)F.push(`Day ${e}`);const L=(g=S.data.data)==null?void 0:g.map(e=>({...e,SPU:e.spins/e.uniquePlayers,CWPP:e.betsEuro/e.uniquePlayers}));V(L);const N=[];for(let e=0;e<14;e++)N.push(`Day ${e+1}`);_e(e=>({...e,xaxis:{categories:N,labels:{show:!1}}})),qe(ut(a,S.data.games,U));const Pe=Object.values(Z.reduce((e,{game:s,summary:d,uniquePlayers:x})=>{e[s]||(e[s]={name:s,data:[]});const u=S.data.games.find(P=>P.name===s);return new Date(u==null?void 0:u.launchDate)<=new Date(d)&&e[s].data.push(x),e},{})).map(e=>{const s=T[0]-1,d=T[1]-1;return e.data=e.data.slice(s,d+1),e});Qe(Pe);const Xe=e=>{if(e.length<6)return[];let s=new Array(5).fill(0);for(let d=5;d<e.length;d++){let x=e.slice(d-4,d+1).reduce((_,ie)=>_+ie,0),u=e.slice(d-5,d).reduce((_,ie)=>_+ie,0),P=((x-u)/(u||1)*100).toFixed(2);s.push(P)}return s},Ze=Object.values(Z.reduce((e,{game:s,summary:d,uniquePlayers:x})=>{e[s]||(e[s]={name:s,data:[]});const u=S.data.games.find(P=>P.name===s);return new Date(u==null?void 0:u.launchDate)<=new Date(d)&&e[s].data.push(x),e},{})).map(e=>({...e,data:Xe(e.data)})).map(e=>{const s=T[0]-1,d=T[1]-1;return e.data=e.data.slice(s,d+1),{...e,data:e.data}});Ye(Ze);const et=Object.values(Z.reduce((e,{game:s,spins:d,summary:x})=>{e[s]||(e[s]={name:s,data:[]});const u=S.data.games.find(P=>P.name===s);return e[s].data.push(new Date(u==null?void 0:u.launchDate)>new Date(x)?0:d),e},{})).map(e=>{const s=T[0]-1,d=T[1]-1;return e.data=e.data.slice(s,d+1),{...e,data:ye(e.data)}});Be(et);const Ue=Object.values(Z.reduce((e,{game:s,spins:d,uniquePlayers:x,summary:u})=>{e[s]||(e[s]={name:s,data:[]});const P=S.data.games.find(_=>_.name===s);return e[s].data.push(new Date(P==null?void 0:P.launchDate)>new Date(u)?0:(d/x).toFixed(2)),e},{})).map(e=>{const s=T[0]-1,d=T[1]-1;return e.data=e.data.slice(s,d+1),{...e,data:ye(e.data)}});z(F),be(e=>({...e,xaxis:{categories:F,labels:{show:!1}}})),Se(e=>({...e,xaxis:{categories:F,labels:{show:!1}},title:{text:"Daily Total Coins Wagered (All Games)",align:"center"},yaxis:{title:{text:"Total Coins"}}})),J(e=>({...e,xaxis:{categories:F,labels:{show:!1}}})),Fe(e=>({...e,xaxis:{categories:F,labels:{show:!1}}})),$e(e=>({...e,xaxis:{categories:F,labels:{show:!1}}})),Ke(e=>({...e,xaxis:{categories:F,labels:{show:!1}}})),Ve(Ue);const Ee=Object.values(Z.reduce((e,{game:s,summary:d,ggrEuro:x})=>{e[s]||(e[s]={name:s,data:[]});const u=S.data.games.find(Ce=>Ce.name===s),P=Z.filter(Ce=>Ce.game===s).reduce((Ce,nt)=>new Date(nt.summary)>new Date(Ce)?nt.summary:Ce,"1970-01-01"),_=new Date(P),ie=new Date(_);return ie.setDate(ie.getDate()-6),new Date(d)>=ie&&new Date(d)<=_&&e[s].data.push(x),e},{})),Ie=Z.reduce((e,s)=>new Date(s.summary)>new Date(e)?s.summary:e,"1970-01-01"),We=new Date(Ie),n=[];for(let e=6;e>=0;e--){const s=new Date(We);s.setDate(s.getDate()-e),n.push(s.toISOString().split("T")[0])}Me(Ee),Ne(e=>({...e,xaxis:{categories:n,labels:{show:!0}},title:{text:"7 Day GGR",align:"center"}}))}}catch{}},Et=async()=>{const m=localStorage.getItem("reportToken");D(m!=="true"),He()};o.useEffect(()=>{Et()},[]);const It=async m=>{if(m.target.files.length>0){const $=m.target.files[0];if(!$){alert("Please select a file first.");return}v(!0);const g=new FormData;g.append("file",$);try{const S=await Te.post("api/reports/upload",g,{headers:{"Content-Type":"multipart/form-data"}});Ae({open:!0,message:"Excel uploaded successfully!",variant:"alert",alert:{color:"success"}}),He(),v(!0)}catch(S){console.error("Upload Error:",S),alert("Error uploading file.")}finally{v(!1),m.target.value=""}}},Ft=async()=>{M(!0);try{const m=await Te.get("api/reports/download",{responseType:"blob"}),$=window.URL.createObjectURL(new Blob([m.data])),g=document.createElement("a");g.href=$,g.setAttribute("download","report.xlsx"),document.body.appendChild(g),g.click(),document.body.removeChild(g)}catch(m){console.error("Download Error:",m),Ae({open:!0,message:"Excel not exists!",variant:"alert",alert:{color:"error"}})}finally{M(!1)}};o.useEffect(()=>{var m;if(w.length>0){const $=w.length>0?(m=w==null?void 0:w.reduce((n,e)=>new Date(e.launchDate)<new Date(n.launchDate)?e:n).launchDate)==null?void 0:m.split("T")[0]:new Date().toISOString().split("T")[0],g=[...k].filter(n=>new Date(n.summary)>=new Date($));g.sort((n,e)=>new Date(n.summary)-new Date(e.summary));const S=[],xe=Object.values(g.reduce((n,{game:e,ggrEuro:s,summary:d})=>{n[e]||(n[e]={name:e,data:[],totalGGR:0});const x=w.find(u=>u.name===e);return n[e].totalGGR+=new Date(x==null?void 0:x.launchDate)>new Date(d)?0:s,n[e].data.push(n[e].totalGGR.toFixed(2)),S.push(d.slice(0,10)),n},{})),Z=g.reduce((n,{summary:e,betsEuro:s,game:d})=>{const x=w.find(u=>u.name===d);if(new Date(x==null?void 0:x.launchDate)<=new Date(e)){const u=e.slice(0,10);n[u]||(n[u]=0),n[u]+=s}return n},{}),pe=[{name:"Total Coins Wagered",data:Object.entries(Z).sort(([n],[e])=>new Date(n)-new Date(e)).map(([n,e])=>Number(e.toFixed(2)))}];let a=0;const b=xe.map(n=>(a=Math.max(a,n.data.length),{...n,data:ye(n.data)})).map(n=>{const e=T[0]-1,s=T[1]-1;return n.data=n.data.slice(e,s+1),n}),O=pe.map(n=>(a=Math.max(a,n.data.length),{...n,data:ye(n.data)})).map(n=>{const e=T[0]-1,s=T[1]-1;return n.data=n.data.slice(e,s+1),n});ne(b),ue(O);const A=[...new Set(S)];de(A);const U=[];for(let n=T[0];n<=T[1];n++)U.push(`Day ${n}`);const F=k==null?void 0:k.map(n=>({...n,SPU:n.spins/n.uniquePlayers,CWPP:n.betsEuro/n.uniquePlayers}));V(F);const L=[];for(let n=0;n<14;n++)L.push(`Day ${n+1}`);_e(n=>({...n,xaxis:{categories:L,labels:{show:!1}}})),qe(ut(xe));const ve=Object.values(g.reduce((n,{game:e,summary:s,uniquePlayers:d})=>{n[e]||(n[e]={name:e,data:[]});const x=w.find(u=>u.name===e);return new Date(x==null?void 0:x.launchDate)<=new Date(s)&&n[e].data.push(d),n},{})).map(n=>{const e=T[0]-1,s=T[1]-1;return n.data=n.data.slice(e,s+1),n});Qe(ve);const Pe=n=>{if(n.length<6)return[];let e=new Array(5).fill(0);for(let s=5;s<n.length;s++){let d=n.slice(s-4,s+1).reduce((P,_)=>P+_,0),x=n.slice(s-5,s).reduce((P,_)=>P+_,0),u=((d-x)/(x||1)*100).toFixed(2);e.push(u)}return e},ze=Object.values(g.reduce((n,{game:e,summary:s,uniquePlayers:d})=>{n[e]||(n[e]={name:e,data:[]});const x=w.find(u=>u.name===e);return new Date(x==null?void 0:x.launchDate)<=new Date(s)&&n[e].data.push(d),n},{})).map(n=>({...n,data:Pe(n.data)})).map(n=>{const e=T[0]-1,s=T[1]-1;return n.data=n.data.slice(e,s+1),{...n,data:n.data}});Ye(ze);const Je=Object.values(g.reduce((n,{game:e,spins:s,summary:d})=>{n[e]||(n[e]={name:e,data:[]});const x=w.find(u=>u.name===e);return n[e].data.push(new Date(x==null?void 0:x.launchDate)>new Date(d)?0:s),n},{})).map(n=>{const e=T[0]-1,s=T[1]-1;return n.data=n.data.slice(e,s+1),{...n,data:ye(n.data)}});Be(Je);const tt=Object.values(g.reduce((n,{game:e,spins:s,uniquePlayers:d,summary:x})=>{n[e]||(n[e]={name:e,data:[]});const u=w.find(P=>P.name===e);return n[e].data.push(new Date(u==null?void 0:u.launchDate)>new Date(x)?0:(s/d).toFixed(2)),n},{})).map(n=>{const e=T[0]-1,s=T[1]-1;return n.data=n.data.slice(e,s+1),{...n,data:ye(n.data)}});z(U),be(n=>({...n,xaxis:{categories:U,labels:{show:!1}}})),Se(n=>({...n,xaxis:{categories:U,labels:{show:!1}},title:{text:"Daily Total Coins Wagered (All Games)",align:"center"},yaxis:{title:{text:"Total Coins"}}})),J(n=>({...n,xaxis:{categories:U,labels:{show:!1}}})),Fe(n=>({...n,xaxis:{categories:U,labels:{show:!1}}})),$e(n=>({...n,xaxis:{categories:U,labels:{show:!1}}})),Ke(n=>({...n,xaxis:{categories:U,labels:{show:!1}}})),Ve(tt);const Ue=Object.values(g.reduce((n,{game:e,summary:s,ggrEuro:d})=>{n[e]||(n[e]={name:e,data:[]}),w.find(_=>_.name===e);const x=g.filter(_=>_.game===e).reduce((_,ie)=>new Date(ie.summary)>new Date(_)?ie.summary:_,"1970-01-01"),u=new Date(x),P=new Date(u);return P.setDate(P.getDate()-6),new Date(s)>=P&&new Date(s)<=u&&n[e].data.push(d),n},{})),Ee=g.reduce((n,e)=>new Date(e.summary)>new Date(n)?e.summary:n,"1970-01-01"),Ie=new Date(Ee),We=[];for(let n=6;n>=0;n--){const e=new Date(Ie);e.setDate(e.getDate()-n),We.push(e.toISOString().split("T")[0])}Me(Ue),Ne(n=>({...n,xaxis:{categories:We,labels:{show:!0}},title:{text:"7 Day GGR",align:"center"}}))}},[k,jt,w,T]);const $t=async()=>{try{const m=await Te.post("api/account/check",{email:c?ee.email:r,password:Q});localStorage.setItem("reportToken","true"),le(!1),D(!1)}catch{le(!0)}};return t.jsxs(Vt,{children:[t.jsx(ge,{children:!h&&t.jsxs(te,{item:!0,xs:12,lg:12,children:[t.jsxs(R,{mb:3,spacing:1,display:"flex",flexDirection:"row",alignItems:"center",gap:2,justifyContent:"space-between",children:[t.jsx(te,{item:!0,children:t.jsxs(R,{spacing:1,children:[t.jsxs(R,{direction:"row",spacing:1,alignItems:"center",children:[t.jsxs("label",{htmlFor:"contained-button-file",children:[t.jsx(xt,{accept:".xls,.xlsx",id:"contained-button-file",type:"file",onChange:It}),t.jsx(it,{loading:E,variant:"contained",component:"span",children:"Upload Excel"})]}),t.jsx(it,{sx:{marginLeft:"10px"},loading:B,variant:"contained",component:"span",onClick:Ft,children:"Download Excel"})]}),t.jsxs(R,{direction:"row",spacing:1,alignItems:"center",children:[t.jsx(G,{variant:"subtitle1",color:"textSecondary",children:"Latest Report Date:"}),t.jsx(G,{variant:"h5",sx:{color:"red",fontWeight:"bold"},children:Oe==null?void 0:Oe.split("T")[0]})]})]})}),t.jsxs(te,{sx:{marginTop:"0px !important"},gap:2,display:"flex",flexDirection:"row",alignItems:"center",children:[t.jsx(G,{variant:"h5",textAlign:"right",children:"LAUNCH"}),t.jsx(ae,{Link:!0,to:c?"/admin/report-type/users/launch":"/report-type/users/launch",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"Users"})}),t.jsx(ae,{to:c?"/admin/report-type/totalGGR/launch":"/report-type/totalGGR/launch",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"Total GGR"})}),t.jsx(ae,{to:c?"/admin/report-type/spinsPerUser/launch":"/report-type/spinsPerUser/launch",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"Spins Per User"})}),t.jsx(ae,{to:c?"/admin/report-type/totalCoins/launch":"/report-type/totalCoins/launch",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"Total Coins"})}),t.jsx(ae,{to:c?"/admin/report-type/cwpp/launch":"/report-type/cwpp/launch",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"CWPP"})})]})]}),t.jsx(R,{mb:3,spacing:1,display:"flex",flexDirection:"row",alignItems:"center",gap:2,justifyContent:"end",children:t.jsxs(te,{sx:{marginTop:"0px !important"},gap:2,display:"flex",flexDirection:"row",alignItems:"center",children:[t.jsx(G,{variant:"h5",textAlign:"right",children:"EXCLUSIVE"}),t.jsx(ae,{to:c?"/admin/report-type/users/exclusive":"/report-type/users/exclusive",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"Users"})}),t.jsx(ae,{to:c?"/admin/report-type/totalGGR/exclusive":"/report-type/totalGGR/exclusive",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"Total GGR"})}),t.jsx(ae,{to:c?"/admin/report-type/spinsPerUser/exclusive":"/report-type/spinsPerUser/exclusive",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"Spins Per User"})}),t.jsx(ae,{to:c?"/admin/report-type/totalCoins/exclusive":"/report-type/totalCoins/exclusive",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"Total Coins"})}),t.jsx(ae,{to:c?"/admin/report-type/cwpp/exclusive":"/report-type/cwpp/exclusive",children:t.jsx(se,{loading:E,variant:"contained",component:"span",children:"CWPP"})})]})}),t.jsx(R,{mb:5,spacing:3,children:t.jsx(ln,{data:k,games:w})}),t.jsxs(R,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"Launch Information"}),t.jsx(je,{data:w,columns:Wt,setData:q})]}),t.jsxs(R,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"TOTAL REVENUE"}),t.jsx(je,{data:Y,columns:At,setData:q})]}),t.jsxs(R,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"7 Day Averages"}),t.jsx(je,{data:he,columns:kt,setData:q})]}),t.jsxs(R,{mb:5,spacing:3,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"7 Day Change (%) "}),t.jsx(je,{data:I,columns:Ot,setData:q})]}),t.jsxs(R,{mb:5,direction:"row",spacing:3,alignItems:"center",justifyContent:"center",children:[t.jsx(G,{variant:"h2",children:"Time Period"}),t.jsx(an,{getAriaLabel:()=>"Temperature range",value:T,max:Rt,min:1,onChange:Lt,valueLabelDisplay:"auto",valueLabelFormat:m=>`Day ${m}`,sx:{width:"40%"}})]}),t.jsxs(R,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"Total GGR"}),t.jsx(De,{options:Ge,series:Y,type:"line",height:500})]}),t.jsxs(R,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"7 DAY GGR"}),t.jsx(De,{options:gt,series:wt,type:"line",height:500})]}),t.jsxs(R,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"Total Coins Wagered"}),t.jsx(De,{options:me,series:Le,type:"line",height:500})]}),t.jsxs(R,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"USERS"}),t.jsx(De,{options:W,series:St,type:"line",height:500})]}),t.jsxs(R,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"USER 5 Day Change (%)"}),t.jsx(De,{options:Dt,series:vt,type:"line",height:500})]}),t.jsxs(R,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"SPINS PER DAY"}),t.jsx(De,{options:ft,series:Ct,type:"line",height:500})]}),t.jsxs(R,{mb:5,children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"SPINS PER PLAYER"}),t.jsx(De,{options:yt,series:Pt,type:"line",height:500})]}),t.jsxs(R,{children:[t.jsx(G,{variant:"h2",textAlign:"center",children:"14 DAY LAUNCH"}),t.jsx(De,{options:mt,series:Gt,type:"line",height:500})]})]})}),t.jsx(qt,{open:h,maxWidth:"xs",children:t.jsxs(_t,{sx:{p:1,py:1.5},children:[c?t.jsx(st,{children:"Confirm Password"}):t.jsx(st,{children:"Login"}),t.jsxs(Qt,{children:[t.jsxs(R,{spacing:1,mb:2,children:[!c&&t.jsx(at,{name:"email",placeholder:"Email",type:"email",fullWidth:!0,variant:"outlined",value:r,onChange:m=>l(m.target.value)}),t.jsx(at,{name:"password",placeholder:"Password",type:"password",fullWidth:!0,variant:"outlined",value:Q,onChange:m=>X(m.target.value)})]}),H&&c&&t.jsx(G,{variant:"h6",color:"red",children:"Password is wrong."}),H&&!c&&t.jsx(G,{variant:"h6",color:"red",children:"Credentials is wrong."}),"          "]}),t.jsx(Yt,{children:t.jsx(se,{variant:"contained",onClick:$t,children:"Confirm"})})]})})]})};export{je as ReactTable,kn as default,Re as separateByComma};
