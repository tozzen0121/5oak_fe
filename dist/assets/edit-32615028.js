import{aG as E,aI as v,aH as O,cb as pe,P as ee,y as ue,aW as fe,r as te,aX as ye,j as e,aY as ge,M as H,c as Ie,z as be,cc as we,aN as _e,G as n,p as c,aQ as p,ad as C,D as T,_ as Ce,B as g,Q as S,aR as A,aL as ie,aM as ne,T as a,d as P,cd as Te,a6 as Ae,a$ as Pe,a_ as qe,aE as re,H as De}from"./index-9ae50f04.js";import{C as Se}from"./CircularLoader-926b29dd.js";import{A as se,I as Le,a as Fe}from"./InvoiceModal-416e2bc8.js";import{u as Ne,a as ke,h as de,b as oe,s as Ee,c as $,f as Oe}from"./invoice-07b96473.js";import{T as $e,a as He,b as Me}from"./TableContainer-101aaec2.js";import{T as Be}from"./TableHead-65748a4a.js";import{T as ce}from"./TableRow-1bb95fef.js";import{T as u}from"./TableCell-5d6e040b.js";import{v as ze}from"./v4-4a60fe23.js";import{D as ae}from"./DatePicker-d8b05e50.js";import{E as Ge}from"./EditOutlined-ea58a507.js";import{P as le}from"./PlusOutlined-12cff1f2.js";import"./Skeleton-26e80784.js";import"./DeleteOutlined-8a559501.js";import"./InputAdornment-5dca9b0a.js";import"./react-pdf.browser.es-3288fc0a.js";import"./index-227f3fc3.js";import"./__vite-browser-external-66d318e3.js";import"./index-656d9c90.js";import"./index-ded096e6.js";import"./DownloadOutlined-41a434b8.js";import"./dateViewRenderers-7d429c0c.js";import"./DesktopDatePicker-e3fc6172.js";import"./useMobilePicker-79668815.js";const Re=E({date:v().required("Invoice date is required"),due_date:v().when("date",(s,l)=>s&&l.min(s,"Due date can't be before invoice date")).nullable().required("Due date is required"),customerInfo:E({name:O().required("Invoice receiver information is required")}).required("Invoice receiver information is required"),status:O().required("Status selection is required"),invoice_detail:pe().required("Invoice details is required").of(E().shape({name:O().required("Product name is required")})).min(1,"Invoice must have at least 1 items")}),xe={name:"",address:"",phone:"",email:""},me=({list:s,invoiceMaster:l})=>{const h=Ie(),L=be(),I=500,F=d=>{var x,f,t;const r={id:Number(s.id),invoice_id:Number(d.invoice_id),customer_name:(x=d.cashierInfo)==null?void 0:x.name,email:(f=d.cashierInfo)==null?void 0:f.email,avatar:Number(s.avatar),discount:Number(d.discount),tax:Number(d.tax),date:re(new Date(d.date),"MM/dd/yyyy"),due_date:re(new Date(d.due_date),"MM/dd/yyyy"),quantity:Number((t=d.invoice_detail)==null?void 0:t.reduce((b,y)=>b+y.qty,0)),status:d.status,cashierInfo:d.cashierInfo,customerInfo:d.customerInfo,invoice_detail:d.invoice_detail,notes:d.notes};Oe(r.id,r),De({open:!0,message:"Invoice Updated successfully",anchorOrigin:{vertical:"top",horizontal:"right"},variant:"alert",alert:{color:"success"},close:!0}),L("/apps/invoice/list")};return e.jsx(we,{enableReinitialize:!0,initialValues:{id:s.id||"",invoice_id:s.invoice_id||"",status:s.status||"",date:new Date(s.date)||null,due_date:new Date(s.due_date)||null,cashierInfo:s.cashierInfo||xe,customerInfo:s.customerInfo||xe,invoice_detail:s.invoice_detail||[],discount:s.discount||0,tax:s.tax||0,notes:s.notes||""},validationSchema:Re,onSubmit:d=>{F(d)},children:({handleBlur:d,errors:r,handleChange:x,handleSubmit:f,values:t,isValid:b,setFieldValue:y,touched:m})=>{var M,B,z,G,R,U,W,Q,X,Y;const w=((M=t==null?void 0:t.invoice_detail)==null?void 0:M.reduce((i,o)=>o.name.trim().length>0?i+Number(o.price*Math.floor(o.qty)):i,0))||0,N=(t==null?void 0:t.tax)*w/100,k=t.discount*w/100,q=w-k+N;return e.jsx(_e,{onSubmit:f,children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(c,{spacing:1,children:[e.jsx(p,{children:"Invoice Id"}),e.jsx(C,{sx:{width:"100%"},children:e.jsx(T,{required:!0,disabled:!0,type:"number",name:"invoice_id",id:"invoice_id",value:t.invoice_id,onChange:x})})]})}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{spacing:1,children:[e.jsx(p,{children:"Status"}),e.jsx(C,{sx:{width:"100%"},children:e.jsxs(Ce,{value:t.status,displayEmpty:!0,name:"status",renderValue:i=>i.length===0?e.jsx(g,{sx:{color:"secondary.400"},children:"Select status"}):i,onChange:x,error:!!(r.status&&m.status),children:[e.jsx(S,{disabled:!0,value:"",children:"Select status"}),e.jsx(S,{value:"Paid",children:"Paid"}),e.jsx(S,{value:"Unpaid",children:"Unpaid"}),e.jsx(S,{value:"Cancelled",children:"Cancelled"})]})})]}),m.status&&r.status&&e.jsx(A,{error:!0,children:r.status})]}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{spacing:1,children:[e.jsx(p,{children:"Date"}),e.jsx(C,{sx:{width:"100%"},error:!!(m.date&&r.date),children:e.jsx(ie,{dateAdapter:ne,children:e.jsx(ae,{format:"dd/MM/yyyy",value:t.date,onChange:i=>y("date",i)})})})]}),m.date&&r.date&&e.jsx(A,{error:!0,children:r.date})]}),e.jsxs(n,{item:!0,xs:12,sm:6,md:3,children:[e.jsxs(c,{spacing:1,children:[e.jsx(p,{children:"Due Date"}),e.jsx(C,{sx:{width:"100%"},error:!!(m.due_date&&r.due_date),children:e.jsx(ie,{dateAdapter:ne,children:e.jsx(ae,{format:"dd/MM/yyyy",value:t.due_date,onChange:i=>y("due_date",i)})})})]}),m.due_date&&r.due_date&&e.jsx(A,{error:!0,children:r.due_date})]}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsx(H,{sx:{minHeight:168},children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:8,children:e.jsxs(c,{spacing:2,children:[e.jsx(a,{variant:"h5",children:"From:"}),e.jsxs(c,{sx:{width:"100%"},children:[e.jsx(a,{variant:"subtitle1",children:(B=t==null?void 0:t.cashierInfo)==null?void 0:B.name}),e.jsx(a,{color:"secondary",children:(z=t==null?void 0:t.cashierInfo)==null?void 0:z.address}),e.jsx(a,{color:"secondary",children:(G=t==null?void 0:t.cashierInfo)==null?void 0:G.phone}),e.jsx(a,{color:"secondary",children:(R=t==null?void 0:t.cashierInfo)==null?void 0:R.email})]})]})}),e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsxs(g,{textAlign:{xs:"left",sm:"right"},color:"grey.200",children:[e.jsx(P,{variant:"outlined",startIcon:e.jsx(Ge,{}),color:"secondary",onClick:()=>de(!0),size:"small",children:"Change"}),e.jsx(se,{open:l.open,setOpen:i=>de(i),handlerAddress:i=>y("cashierInfo",i)})]})})]})})}),e.jsxs(n,{item:!0,xs:12,sm:6,children:[e.jsx(H,{sx:{minHeight:168},children:e.jsxs(n,{container:!0,spacing:2,children:[e.jsx(n,{item:!0,xs:12,sm:8,children:e.jsxs(c,{spacing:2,children:[e.jsx(a,{variant:"h5",children:"To:"}),e.jsxs(c,{sx:{width:"100%"},children:[e.jsx(a,{variant:"subtitle1",children:(U=t==null?void 0:t.customerInfo)==null?void 0:U.name}),e.jsx(a,{color:"secondary",children:(W=t==null?void 0:t.customerInfo)==null?void 0:W.address}),e.jsx(a,{color:"secondary",children:(Q=t==null?void 0:t.customerInfo)==null?void 0:Q.phone}),e.jsx(a,{color:"secondary",children:(X=t==null?void 0:t.customerInfo)==null?void 0:X.email})]})]})}),e.jsx(n,{item:!0,xs:12,sm:4,children:e.jsxs(g,{textAlign:"right",color:"grey.200",children:[e.jsx(P,{size:"small",startIcon:e.jsx(le,{}),color:"secondary",variant:"outlined",onClick:()=>oe(!0),children:"Add"}),e.jsx(se,{open:l.isCustomerOpen,setOpen:i=>oe(i),handlerAddress:i=>y("customerInfo",i)})]})})]})}),m.customerInfo&&r.customerInfo&&e.jsx(A,{error:!0,children:(Y=r==null?void 0:r.customerInfo)==null?void 0:Y.name})]}),e.jsx(n,{item:!0,xs:12,children:e.jsx(a,{variant:"h5",children:"Detail"})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(Te,{name:"invoice_detail",render:({remove:i,push:o})=>{var D,_,J,K,V,Z;return e.jsxs(e.Fragment,{children:[e.jsx($e,{children:e.jsxs(He,{sx:{minWidth:650},children:[e.jsx(Be,{children:e.jsxs(ce,{children:[e.jsx(u,{children:"#"}),e.jsx(u,{children:"Name"}),e.jsx(u,{children:"Description"}),e.jsx(u,{children:"Qty"}),e.jsx(u,{children:"Price"}),e.jsx(u,{align:"right",children:"Amount"}),e.jsx(u,{align:"center",children:"Action"})]})}),e.jsx(Me,{children:(D=t==null?void 0:t.invoice_detail)==null?void 0:D.map((j,he)=>e.jsxs(ce,{children:[e.jsx(u,{children:(t==null?void 0:t.invoice_detail.indexOf(j))+1}),e.jsx(Le,{id:j.id,index:he,name:j.name,description:j.description,qty:j.qty,price:j.price,onDeleteItem:je=>i(je),onEditItem:x,Blur:d,errors:r,touched:m},j.id)]},j.id))})]})}),e.jsx(Ae,{}),m.invoice_detail&&r.invoice_detail&&!Array.isArray(r==null?void 0:r.invoice_detail)&&e.jsx(c,{direction:"row",justifyContent:"center",sx:{p:1.5},children:e.jsx(A,{error:!0,children:r.invoice_detail})}),e.jsxs(n,{container:!0,justifyContent:"space-between",children:[e.jsx(n,{item:!0,xs:12,md:8,children:e.jsx(g,{sx:{pt:2.5,pr:2.5,pb:2.5,pl:0},children:e.jsx(P,{color:"primary",startIcon:e.jsx(le,{}),onClick:()=>o({id:ze(),name:"",description:"",qty:1,price:"1.00"}),variant:"dashed",sx:{bgcolor:"transparent !important"},children:"Add Item"})})}),e.jsxs(n,{item:!0,xs:12,md:4,children:[e.jsxs(n,{container:!0,justifyContent:"space-between",spacing:2,sx:{pt:2.5,pb:2.5},children:[e.jsx(n,{item:!0,xs:6,children:e.jsxs(c,{spacing:1,children:[e.jsx(p,{children:"Discount(%)"}),e.jsx(T,{type:"number",fullWidth:!0,name:"discount",id:"discount",placeholder:"0.0",value:t.discount,onChange:x,inputProps:{min:0}})]})}),e.jsx(n,{item:!0,xs:6,children:e.jsxs(c,{spacing:1,children:[e.jsx(p,{children:"Tax(%)"}),e.jsx(T,{type:"number",fullWidth:!0,name:"tax",id:"tax",placeholder:"0.0",value:t.tax,onChange:x,inputProps:{min:0}})]})})]}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(c,{spacing:2,children:[e.jsxs(c,{direction:"row",justifyContent:"space-between",children:[e.jsx(a,{color:h.palette.grey[500],children:"Sub Total:"}),e.jsx(a,{children:((_=l.country)==null?void 0:_.prefix)+""+w.toFixed(2)})]}),e.jsxs(c,{direction:"row",justifyContent:"space-between",children:[e.jsx(a,{color:h.palette.grey[500],children:"Discount:"}),e.jsx(a,{variant:"h6",color:h.palette.success.main,children:((J=l.country)==null?void 0:J.prefix)+""+k.toFixed(2)})]}),e.jsxs(c,{direction:"row",justifyContent:"space-between",children:[e.jsx(a,{color:h.palette.grey[500],children:"Tax:"}),e.jsx(a,{children:((K=l.country)==null?void 0:K.prefix)+""+N.toFixed(2)})]}),e.jsxs(c,{direction:"row",justifyContent:"space-between",children:[e.jsx(a,{variant:"subtitle1",children:"Grand Total:"}),e.jsx(a,{variant:"subtitle1",children:q%1===0?((V=l.country)==null?void 0:V.prefix)+""+q:((Z=l.country)==null?void 0:Z.prefix)+""+q.toFixed(2)})]})]})})]})]})]})}})}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(c,{spacing:1,children:[e.jsx(p,{children:"Notes"}),e.jsx(T,{placeholder:"Address",rows:3,value:t.notes,multiline:!0,name:"notes",onChange:x,inputProps:{maxLength:I},helperText:`${t.notes.length} / ${I}`,sx:{width:"100%","& .MuiFormHelperText-root":{mr:0,display:"flex",justifyContent:"flex-end"}}})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(c,{spacing:1,children:[e.jsx(p,{children:"Set Currency*"}),e.jsx(C,{sx:{width:{xs:"100%",sm:250}},children:e.jsx(Pe,{id:"country-select-demo",fullWidth:!0,options:l.countries,defaultValue:l.countries[2],value:l.countries.find(i=>{var o;return i.code===((o=l.country)==null?void 0:o.code)}),onChange:(i,o)=>Ee(o),autoHighlight:!0,getOptionLabel:i=>i.label,renderOption:(i,o)=>e.jsxs(g,{component:"li",sx:{"& > img":{mr:2,flexShrink:0}},...i,children:[o.code&&e.jsx("img",{loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${o.code.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w40/${o.code.toLowerCase()}.png 2x`,alt:""}),o.label]}),renderInput:i=>{const o=l.countries.find(D=>{var _;return D.code===((_=l.country)==null?void 0:_.code)});return e.jsx(T,{...i,name:"phoneCode",placeholder:"Select",InputProps:{...i.InputProps,startAdornment:e.jsx(e.Fragment,{children:o&&o.code!==""&&e.jsx("img",{style:{marginRight:6},loading:"lazy",width:"20",src:`https://flagcdn.com/w20/${o.code.toLowerCase()}.png`,srcSet:`https://flagcdn.com/w40/${o.code.toLowerCase()}.png 2x`,alt:""})})},inputProps:{...i.inputProps,autoComplete:"new-password"}})}})})]})}),e.jsx(n,{item:!0,xs:12,sm:6,children:e.jsxs(c,{direction:"row",justifyContent:"flex-end",alignItems:"flex-end",spacing:2,sx:{height:"100%"},children:[e.jsx(P,{variant:"outlined",color:"secondary",disabled:!b,sx:{color:"secondary.dark"},onClick:()=>$(!0),children:"Preview"}),e.jsx(P,{color:"primary",variant:"contained",type:"submit",children:"Update & Send"}),e.jsx(Fe,{isOpen:l.isOpen,setIsOpen:i=>$(i),invoiceInfo:{...t,subtotal:w,taxRate:N,discountRate:k,total:q},items:t==null?void 0:t.invoice_detail,onAddNextInvoice:()=>$(!1)},t.invoice_id)]})})]})})}})};me.propTypes={list:ee.object,invoiceMaster:ee.object};const jt=()=>{const{id:s}=ue(),{menuMaster:l}=fe(),{invoiceLoading:h,invoice:L}=Ne(),{invoiceMaster:I,invoiceMasterLoading:F}=ke(),[d,r]=te.useState(null);te.useEffect(()=>{l.openedItem!=="invoice-edit"&&ye("invoice-edit"),s&&!h&&r(L.filter(b=>b.id.toString()===s)[0])},[s,h]);const x=e.jsx(g,{sx:{height:"calc(100vh - 310px)"},children:e.jsx(Se,{})});let f=[{title:"Home",to:qe},{title:"Invoice",to:"/apps/invoice/dashboard"},{title:"Edit"}];const t=h||F||I===void 0||d===null;return e.jsxs(e.Fragment,{children:[e.jsx(ge,{custom:!0,heading:"New Invoice",links:f}),e.jsx(H,{children:t?x:e.jsx(me,{list:d,invoiceMaster:I})})]})};export{jt as default};
